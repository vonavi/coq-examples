<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<title>Coq auto tactic fails</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><div class="document" id="coq-auto-tactic-fails">
<h1 class="title">Coq <tt class="docutils literal">auto</tt> tactic fails</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr class="link field"><th class="docinfo-name">Link:</th><td class="field-body"><a class="reference external" href="https://stackoverflow.com/q/61677391">https://stackoverflow.com/q/61677391</a></td>
</tr>
</tbody>
</table>
<input type="checkbox" class="alectryon-toggle" id="alectryon-toggle-0" /><label for="alectryon-toggle-0" class="alectryon-toggle-label">Display all goals and responses</label><div class="alectryon-container docutils container">
<div class="section" id="question">
<h1>Question</h1>
<p>I have the following Coq program that tries to prove <tt class="docutils literal">n &lt;= 2^n</tt> with
<tt class="docutils literal">auto</tt>:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="sd">(***********)</span>
<span class="c">(* imports *)</span>
<span class="sd">(***********)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Nat.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="sd">(************************)</span>
<span class="c">(* exponential function *)</span>
<span class="sd">(************************)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">f</span> (<span class="nv">a</span> : nat) : nat := <span class="mi">2</span>^a.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk0"><span class="kn">Hint Resolve</span> plus_n_O.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Adding <span class="kn">and</span> removing hints <span class="kr">in</span> the core database
implicitly <span class="kr">is</span> deprecated. Please specify a hint
database. [implicit-core-hint-db,deprecated]</blockquote><blockquote class="alectryon-message">The default value <span class="kr">for</span> hint locality <span class="kr">is</span> currently
<span class="s2">&quot;local&quot;</span> <span class="kr">in</span> a section <span class="kn">and</span> <span class="s2">&quot;global&quot;</span> otherwise, but <span class="kr">is</span>
scheduled to <span class="nb">change</span> <span class="kr">in</span> a future release. For the <span class="kp">time</span>
being, adding hints <span class="kn">outside</span> of sections without
specifying an explicit locality <span class="kr">is</span> therefore
deprecated. It <span class="kr">is</span> recommended to use <span class="s2">&quot;export&quot;</span> whenever
possible.
[deprecated-hint-without-locality,deprecated]</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk1"><span class="kn">Hint Resolve</span> plus_n_Sm.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Adding <span class="kn">and</span> removing hints <span class="kr">in</span> the core database
implicitly <span class="kr">is</span> deprecated. Please specify a hint
database. [implicit-core-hint-db,deprecated]</blockquote><blockquote class="alectryon-message">The default value <span class="kr">for</span> hint locality <span class="kr">is</span> currently
<span class="s2">&quot;local&quot;</span> <span class="kr">in</span> a section <span class="kn">and</span> <span class="s2">&quot;global&quot;</span> otherwise, but <span class="kr">is</span>
scheduled to <span class="nb">change</span> <span class="kr">in</span> a future release. For the <span class="kp">time</span>
being, adding hints <span class="kn">outside</span> of sections without
specifying an explicit locality <span class="kr">is</span> therefore
deprecated. It <span class="kr">is</span> recommended to use <span class="s2">&quot;export&quot;</span> whenever
possible.
[deprecated-hint-without-locality,deprecated]</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="sd">(**********************)</span>
<span class="c">(* inequality theorem *)</span>
<span class="sd">(**********************)</span>
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk2"><span class="kn">Theorem</span> <span class="nf">a_leq_pow_2_a</span>: <span class="kr">forall</span> <span class="nv">a</span>, a &lt;= f(a).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : nat, a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : nat, a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk4"><span class="nb">auto with</span> *.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : nat, a &lt;= f a</div></blockquote></div></div></small></span></pre><p>I expected Coq to either succeed or get stuck trying to. But it
immediately returns. What am I doing wrong?</p>
<p><strong>EDIT</strong> I added the <tt class="docutils literal">Hint Unfold f.</tt>, and increased bound to 100
but I can't see any unfolding done with <tt class="docutils literal">debug auto 100</tt>:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  <span class="c">(* debug auto: *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk5">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : nat, a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input alectryon-failed" for="coq-auto-tactic-fails-v-chk6"><span class="bp">assumption</span>. <span class="c">(*fail*)</span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">No such <span class="bp">assumption</span>.</blockquote></div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : nat, a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk7">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : nat, a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk8"><span class="nb">intro</span>. <span class="c">(*success*)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input alectryon-failed" for="coq-auto-tactic-fails-v-chk9"><span class="bp">assumption</span>. <span class="c">(*fail*)</span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">No such <span class="bp">assumption</span>.</blockquote></div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chka" style="display: none" type="checkbox"><label class="alectryon-input alectryon-failed" for="coq-auto-tactic-fails-v-chka"><span class="nb">intro</span>. <span class="c">(*fail*)</span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">No product even <span class="nb">after</span> head-reduction.</blockquote></div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input alectryon-failed" for="coq-auto-tactic-fails-v-chkb"><span class="nb">simple apply</span> le_n. <span class="c">(*fail*)</span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">In environment
a : nat
Unable to <span class="nb">unify</span> <span class="s2">&quot;f a&quot;</span> <span class="kr">with</span> <span class="s2">&quot;a&quot;</span>.</blockquote></div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input alectryon-failed" for="coq-auto-tactic-fails-v-chkc"><span class="nb">simple apply</span> le_S. <span class="c">(*fail*)</span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">In environment
a : nat
Unable to <span class="nb">unify</span> <span class="s2">&quot;?M166 &lt;= S ?M167&quot;</span> <span class="kr">with</span> <span class="s2">&quot;a &lt;= f a&quot;</span>.</blockquote></div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span></pre><p><strong>EDIT 2</strong> I'm adding the manual proof to demonstrate its complexity:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="sd">(**********************)</span>
<span class="c">(* inequality theorem *)</span>
<span class="sd">(**********************)</span>
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chkd"><span class="kn">Theorem</span> <span class="nf">a_leq_pow_2_a</span>: <span class="kr">forall</span> <span class="nv">a</span>, a &lt;= f(a).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : nat, a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chke"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : nat, a &lt;= f a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chkf"><span class="nb">induction</span> a <span class="kr">as</span> [|a&#39; IHa].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt;= f <span class="mi">0</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="coq-auto-tactic-fails-v-chk10" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><label class="goal-separator" for="coq-auto-tactic-fails-v-chk10"><hr></label><div class="goal-conclusion">S a&#39; &lt;= f (S a&#39;)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk11">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt;= f <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> le_0_n.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk12">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S a&#39; &lt;= f (S a&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk13"><span class="nb">unfold</span> f.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S a&#39; &lt;= <span class="mi">2</span> ^ S a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk14"><span class="nb">rewrite</span> Nat.pow_succ_r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S a&#39; &lt;= <span class="mi">2</span> * <span class="mi">2</span> ^ a&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="coq-auto-tactic-fails-v-chk15" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><label class="goal-separator" for="coq-auto-tactic-fails-v-chk15"><hr></label><div class="goal-conclusion"><span class="mi">0</span> &lt;= a&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk16">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S a&#39; &lt;= <span class="mi">2</span> * <span class="mi">2</span> ^ a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk17"><span class="nb">rewrite</span> Nat.mul_comm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S a&#39; &lt;= <span class="mi">2</span> ^ a&#39; * <span class="mi">2</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk18"><span class="nb">rewrite</span> Nat.mul_succ_r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S a&#39; &lt;= <span class="mi">2</span> ^ a&#39; * <span class="mi">1</span> + <span class="mi">2</span> ^ a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk19"><span class="nb">rewrite</span> Nat.mul_1_r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S a&#39; &lt;= <span class="mi">2</span> ^ a&#39; + <span class="mi">2</span> ^ a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk1a"><span class="nb">unfold</span> f <span class="kr">in</span> IHa.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S a&#39; &lt;= <span class="mi">2</span> ^ a&#39; + <span class="mi">2</span> ^ a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk1b" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk1b"><span class="nb">rewrite</span> Nat.add_le_mono <span class="kr">with</span> (n:=<span class="mi">1</span>) (m:=<span class="mi">2</span>^a&#39;) (p:=a&#39;) (q:=<span class="mi">2</span>^a&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ a&#39; + <span class="mi">2</span> ^ a&#39; &lt;= <span class="mi">2</span> ^ a&#39; + <span class="mi">2</span> ^ a&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="coq-auto-tactic-fails-v-chk1c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><label class="goal-separator" for="coq-auto-tactic-fails-v-chk1c"><hr></label><div class="goal-conclusion"><span class="mi">1</span> &lt;= <span class="mi">2</span> ^ a&#39;</div></blockquote><input class="alectryon-extra-goal-toggle" id="coq-auto-tactic-fails-v-chk1d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><label class="goal-separator" for="coq-auto-tactic-fails-v-chk1d"><hr></label><div class="goal-conclusion">a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk1e">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> ^ a&#39; + <span class="mi">2</span> ^ a&#39; &lt;= <span class="mi">2</span> ^ a&#39; + <span class="mi">2</span> ^ a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk1f" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk1f">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">1</span> &lt;= <span class="mi">2</span> ^ a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk20"><span class="nb">apply</span> Nat.pow_le_mono_r <span class="kr">with</span> (a:=<span class="mi">2</span>) (b:=<span class="mi">0</span>) (c:=a&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">2</span> &lt;&gt; <span class="mi">0</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="coq-auto-tactic-fails-v-chk21" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><label class="goal-separator" for="coq-auto-tactic-fails-v-chk21"><hr></label><div class="goal-conclusion"><span class="mi">0</span> &lt;= a&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk22"><span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt;= a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> le_0_n.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk23" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk23">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">a&#39; &lt;= <span class="mi">2</span> ^ a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> IHa.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk24" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk24">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a'</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHa</var><span class="hyp-type"><b>: </b><span>a&#39; &lt;= f a&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt;= a&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> le_0_n.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre></div>
<div class="section" id="answer-yves">
<h1>Answer (Yves)</h1>
<p>The manual proof that you performed explains why <tt class="docutils literal">auto</tt> can't do it.
You did a proof by induction and then a few rewrites. The <tt class="docutils literal">auto</tt>
tactic does not allow itself this kind of step.</p>
<p>The tactic <tt class="docutils literal">auto</tt> is meant to find a proof if a manual proof only
uses <tt class="docutils literal">apply</tt> with a restricted set of theorems. Here the restrict
set of theorems is taken from the <tt class="docutils literal">core</tt> hint database. For the sake
of brevity, let's assume this database only contains <tt class="docutils literal">le_S</tt>,
<tt class="docutils literal">le_n</tt>, <tt class="docutils literal">plus_n_O</tt> and <tt class="docutils literal">plus_n_Sm</tt>.</p>
<p>To simplify, let's assume that we work with the goal <tt class="docutils literal">a &lt;= 2 ^ a</tt>.
The head predicate of this statement is <tt class="docutils literal">_ &lt;= _</tt> so the tactic will
only look at theorems whose principal statement is expressed with <tt class="docutils literal">_
&lt;= _</tt>. This rules out <tt class="docutils literal">plus_n_O</tt> and <tt class="docutils literal">plus_n_Sm</tt>. Your initiative
of adding these goes down the drain.</p>
<p>If we look at <tt class="docutils literal">le_n</tt> the statement is <tt class="docutils literal">forall n : nat, n &lt;= n</tt>. If
we replace the universal quantification by a <em>pattern variable</em>, this
pattern is <tt class="docutils literal"><span class="pre">?1</span> &lt; <span class="pre">?1</span></tt>. Does this unify with <tt class="docutils literal">a &lt;= 2 ^ a</tt>? The
answer is no. so this theorem won't be used by <tt class="docutils literal">auto</tt>. Now if we
look at <tt class="docutils literal">le_S</tt>, the pattern of the principal statement is <tt class="docutils literal"><span class="pre">?1</span> &lt;= S
<span class="pre">?2</span></tt>. Unifying this pattern with <tt class="docutils literal">a &lt;= 2 ^ a</tt>, this would require
<tt class="docutils literal"><span class="pre">?1</span></tt> to be <tt class="docutils literal">a</tt>. Now what could be the value of <tt class="docutils literal"><span class="pre">?2</span></tt>? We need to
compare symbolically the expressions <tt class="docutils literal">2 ^ a</tt> and <tt class="docutils literal">S <span class="pre">?2</span></tt>. On the
left hand side the function symbol is either <tt class="docutils literal">_ ^ _</tt> or <tt class="docutils literal">2 ^ _</tt>
depending on how you wish to look at it, but anyway this is not <tt class="docutils literal">S</tt>.
So <tt class="docutils literal">auto</tt> recognizes these functions are not the same, the lemma
cannot apply. <tt class="docutils literal">auto</tt> fails.</p>
<p>I repeat: when given a goal, <tt class="docutils literal">auto</tt> first only looks at the head
symbol of the goal, and it selects from its database the theorems that
achieves proofs for this head symbol. In your example, the head symbol
is <tt class="docutils literal">_ &lt;= _</tt>. Then it looks only at the conclusion of these theorems,
and checks whether the conclusion matches syntactically with the goal
at hand. If it does match, then this should provide values for the
universally quantified variables of the theorem, and the premises of
the theorem are new goals that should be solved at a lower depth. As
was mentioned by &#64;Elazar, the depth is limited to 5 by default.</p>
<p>The <tt class="docutils literal">Hint unfold</tt> directive would be useful only if you had made a
definition of the following shape:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">myle</span> (<span class="nv">x</span> <span class="nv">y</span> : nat) := x &lt;= y.</span></span></pre><p>Then <tt class="docutils literal">Hint Unfold myle : core.</tt> would be useful to make sure that
the database theorems for <tt class="docutils literal">_ &lt;= _</tt> are also used to proved instances
of <tt class="docutils literal">myle</tt>, as in the following example (it fails if we have 4
occurrences of <tt class="docutils literal">S</tt>, because of the depth limitation).</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk25" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk25"><span class="kn">Lemma</span> <span class="nf">myle3</span> (<span class="nv">x</span> : nat) : myle x (S (S (S x))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">myle x (S (S (S x)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk26"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">myle x (S (S (S x)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto with</span> core.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Please note that the following statement is logically equivalent
(according to the definition of addition) but not provable by
<tt class="docutils literal">auto</tt>. Even if you add <tt class="docutils literal">Hint Unfold plus : core.</tt> as a directive,
this won't help because <tt class="docutils literal">plus</tt> is not the head symbol of the goal.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk27"><span class="kn">Lemma</span> <span class="nf">myleplus3</span> (<span class="nv">x</span> : nat) : myle x (<span class="mi">3</span> + x).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">myle x (<span class="mi">3</span> + x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk28"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">myle x (<span class="mi">3</span> + x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk29" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk29"><span class="nb">auto</span>. <span class="c">(* the goal is unchanged. *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">myle x (<span class="mi">3</span> + x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-auto-tactic-fails-v-chk2a" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-auto-tactic-fails-v-chk2a"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">myle x (S (S (S x)))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>I often use automatic tactics from Coq, for instance <tt class="docutils literal">lia</tt>, but I
always do so because I can predict if the goal is part of the intended
scope of the tactic.</p>
</div>
<div class="section" id="answer-elazar">
<h1>Answer (Elazar)</h1>
<p>From the <a class="reference external" href="https://coq.inria.fr/refman/proof-engine/tactics.html#coq:tacn.auto">documentation</a>:</p>
<blockquote>
This tactic implements a Prolog-like resolution procedure to solve
the current goal. It first tries to solve the goal using the
assumption tactic, then it reduces the goal to an atomic one using
intros and introduces the newly generated hypotheses as hints.
Then it looks at the list of tactics associated to the head symbol
of the goal and tries to apply one of them (starting from the
tactics with lower cost). This process is recursively applied to
the generated subgoals.</blockquote>
<p>Also, see the warning there:</p>
<blockquote>
<tt class="docutils literal">auto</tt> uses a weaker version of apply that is closer to simple
apply so it is expected that sometimes auto will fail even if
applying manually one of the hints would succeed.</blockquote>
<p>And finally, the search depth is limited to 5 by default; you can
control it using <tt class="docutils literal">auto num</tt>.</p>
<p>So if at any point, none of the &quot;tactics associated to the head
symbol&quot; of the current goal makes any progress, <tt class="docutils literal">auto</tt> will fail.
And if <tt class="docutils literal">auto</tt> reaches maximum depth, it will fail.</p>
<p>Note that <tt class="docutils literal">auto</tt> it does not automatically apply the <tt class="docutils literal">unfold</tt>
tactic. There's no way to solve <tt class="docutils literal">a &lt;= f(a)</tt> when <tt class="docutils literal">f</tt> is opaque,
without further assumptions. If you want, you can use <a class="reference external" href="https://coq.inria.fr/refman/proof-engine/tactics.html#coq:cmdv.hint-unfold">Hint Unfold f</a>
or <a class="reference external" href="https://coq.inria.fr/refman/proof-engine/tactics.html#coq:cmdv.hint-transparent">Hint Transparent f</a>.</p>
</div>
</div>
</div>
</div></body>
</html>
