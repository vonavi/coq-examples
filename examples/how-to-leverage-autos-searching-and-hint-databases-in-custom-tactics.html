<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta charset="utf-8" />
<meta name="generator" content="Docutils 0.20.1: https://docutils.sourceforge.io/" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>How to leverage auto's searching and hint databases in custom tactics?</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><main id="how-to-leverage-auto-s-searching-and-hint-databases-in-custom-tactics">
<h1 class="title">How to leverage <span class="docutils literal">auto</span>'s searching and hint databases in custom tactics?</h1>
<dl class="docinfo simple">
<dt class="link">Link<span class="colon">:</span></dt>
<dd class="link"><p><a class="reference external" href="https://stackoverflow.com/q/41171406">https://stackoverflow.com/q/41171406</a></p>
</dd>
</dl>
<section id="question">
<h2>Question</h2>
<p>In my coq development I am learning how to create new tactics tailored
to my problem domain, a la <a class="reference external" href="http://adam.chlipala.net/cpdt/html/Match.html">Prof. Adam Chlipala</a>. On that page he
describes how to create powerful custom tactics by e.g. combining
<span class="docutils literal">repeat</span> with <span class="docutils literal">match</span>.</p>
<p>Now, I already have a powerful one-shot tactic in use, <a class="reference external" href="https://coq.inria.fr/refman/Reference-Manual010.html#sec390">auto</a>. It
strings together chains of steps found from hint databases. I have
invested some effort in curating those hint databases, so I'd like to
continue using it as well.</p>
<p>However this presents a problem. <strong>It isn't clear what the &quot;right&quot; way
is to incorporate</strong> <span class="docutils literal">auto</span><strong>'s functionality into customized
tactics.</strong></p>
<p>For example, since (per its page) <span class="docutils literal">auto</span> always either solves the
goal or does nothing, putting it inside a loop is no more powerful
than calling it once after the loop.</p>
<p>To see why this isn't ideal, consider a hypothetical way to directly
call a single &quot;step&quot; of <span class="docutils literal">auto</span>, which succeeds if it could make a
change (as opposed to only when it solved the goal) and fails
otherwise. Such single-steps could be interleaved with custom behavior
in a match repeat loop, allowing us to e.g. <span class="docutils literal">try contradiction</span> or
<span class="docutils literal">try congruence</span> at intermediate points within the search tree.</p>
<p>Are there good design patterns for incorporating <span class="docutils literal">auto</span>'s
functionality into custom tactics?</p>
<p>Can <span class="docutils literal">auto</span>'s behavior be decomposed into &quot;single step&quot; tactics that
we can use?</p>
</section>
<section id="answer">
<h2>Answer</h2>
<p>What I would do instead would be to incorporate other tactics within
<a class="reference external" href="https://coq.inria.fr/refman/proof-engine/tactics.html#coq:tacn.auto">auto</a>.
You can do so by using the <a class="reference external" href="https://coq.inria.fr/refman/proof-engine/tactics.html#coq:cmdv.hint-extern">Hint Extern num pat =&gt; mytactic : mybase</a>
command where <span class="docutils literal">num</span> is a priority number (0 being the highest
priority), <span class="docutils literal">pat</span> a pattern to filter when the hint should be used
and <span class="docutils literal">mytactic</span> and <span class="docutils literal">mybase</span> are of course the tactic you want to
apply and the base you want to add the hint to (do not use the default
<span class="docutils literal">core</span>; build up your custom base instead and call it with <span class="docutils literal">auto with mybase</span>; if you do not want to include the lemmas from the
<span class="docutils literal">core</span> base in the search, add the fake base <span class="docutils literal">nocore</span>: <span class="docutils literal">auto with mybase nocore</span>).</p>
<p>If you start relying on <span class="docutils literal">auto</span> very much, I would switch instead to
the almost equivalent but better behaved <a class="reference external" href="https://coq.inria.fr/refman/addendum/type-classes.html#coq:tacn.typeclasses-eauto">typeclasses eauto with
mybase</a>.
Contrary to what its name suggests, it is a general purpose tactic
that has nothing to do with type classes (as long as you explicitly
provide the hint base on which it should be working). One of the main
behavior difference to know is that the search depth is unbounded by
default. So beware of possible infinite loops or fix a finite limit
with the variant <span class="docutils literal">typeclasses eauto num with mybase</span>.</p>
</section>
</main>
</div></body>
</html>
