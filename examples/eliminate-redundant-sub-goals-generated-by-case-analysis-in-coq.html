<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta charset="utf-8" />
<meta name="generator" content="Docutils 0.20.1: https://docutils.sourceforge.io/" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Eliminate redundant sub-goals generated by case analysis in Coq</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><main id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq">
<h1 class="title">Eliminate redundant sub-goals generated by case analysis in Coq</h1>
<dl class="docinfo simple">
<dt class="link">Link<span class="colon">:</span></dt>
<dd class="link"><p><a class="reference external" href="https://stackoverflow.com/q/45264991">https://stackoverflow.com/q/45264991</a></p>
</dd>
</dl>
<input type="checkbox" class="alectryon-toggle" id="alectryon-toggle-0" /><label for="alectryon-toggle-0" class="alectryon-toggle-label">Display all goals and responses</label><div class="alectryon-container docutils container">
<section id="question">
<h2>Question</h2>
<p>With a simple definition</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">B</span> := bb.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">C</span> := cc.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">A</span> :=
| mkA1 : B -&gt; A
| mkA2 : C -&gt; A.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">id</span> (<span class="nv">a</span> : A) : A :=
  <span class="kr">match</span> a <span class="kr">with</span>
  | mkA1 b =&gt; mkA1 b
  | mkA2 c =&gt; mkA2 c
  <span class="kr">end</span>.</span></span></pre><p>I try to do proofs by case analysis (destruct), something like:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk0"><span class="kn">Theorem</span> <span class="nf">Foo</span> :
  <span class="kr">forall</span> <span class="nv">a1</span> <span class="nv">a2</span> : A , a1 &lt;&gt; a2 -&gt; id a1 &lt;&gt; id a2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a1</span> <span class="nv">a2</span> : A, a1 &lt;&gt; a2 -&gt; id a1 &lt;&gt; id a2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a1</span> <span class="nv">a2</span> : A, a1 &lt;&gt; a2 -&gt; id a1 &lt;&gt; id a2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk2"><span class="nb">destruct</span> a1; <span class="nb">destruct</span> a2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>b, b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mkA1 b &lt;&gt; mkA1 b0 -&gt; id (mkA1 b) &lt;&gt; id (mkA1 b0)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk3"><hr></label><div class="goal-conclusion">mkA1 b &lt;&gt; mkA2 c -&gt; id (mkA1 b) &lt;&gt; id (mkA2 c)</div></blockquote><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk4"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA1 b -&gt; id (mkA2 c) &lt;&gt; id (mkA1 b)</div></blockquote><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c, c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk5"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA2 c0 -&gt; id (mkA2 c) &lt;&gt; id (mkA2 c0)</div></blockquote></div></div></div></small></span></pre><p>Unsurprisingly, the current prove state contains two equivalent
sub-goals:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input checked="checked" class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk6" style="display: none" type="checkbox"><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message"><span class="mi">4</span> subgoals

  b, b0 : B
  ============================
  mkA1 b &lt;&gt; mkA1 b0 -&gt; id (mkA1 b) &lt;&gt; id (mkA1 b0)

subgoal <span class="mi">2</span> <span class="kr">is</span>:
 mkA1 b &lt;&gt; mkA2 c -&gt; id (mkA1 b) &lt;&gt; id (mkA2 c)
subgoal <span class="mi">3</span> <span class="kr">is</span>:
 mkA2 c &lt;&gt; mkA1 b -&gt; id (mkA2 c) &lt;&gt; id (mkA1 b)
subgoal <span class="mi">4</span> <span class="kr">is</span>:
 mkA2 c &lt;&gt; mkA2 c0 -&gt; id (mkA2 c) &lt;&gt; id (mkA2 c0)</blockquote></div></div></small></span></pre><p>It seems to me that duplicated sub-goals are quite often when doing
structural case analysis. Is there some common way to remove these
duplicates?</p>
<p>What I did is to massage the second sub-goal to look like the third:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk7"><span class="mi">2</span>: <span class="nb">intro</span>; <span class="nb">apply</span> not_eq_sym <span class="kr">in</span> H; <span class="nb">apply</span> not_eq_sym; <span class="nb">revert</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>b, b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mkA1 b &lt;&gt; mkA1 b0 -&gt; id (mkA1 b) &lt;&gt; id (mkA1 b0)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk8"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA1 b -&gt; id (mkA2 c) &lt;&gt; id (mkA1 b)</div></blockquote><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk9"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA1 b -&gt; id (mkA2 c) &lt;&gt; id (mkA1 b)</div></blockquote><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chka" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c, c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chka"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA2 c0 -&gt; id (mkA2 c) &lt;&gt; id (mkA2 c0)</div></blockquote></div></div></div></small></span></pre><p>Although I still have no way to ask Coq to remove the duplicates. Now
I can prove a lemma for my second sub-goal, and reuse it in my third
sub-goal. But I would like to know some alternatives.</p>
</section>
<section id="answer">
<h2>Answer</h2>
<p>Here is some tactic automation that de-duplicates subgoals. Note that
not only must the goals match exactly, but the ordering of the
contexts must also match. You also need to run the initialization
tactic before you do case analysis. This is code for Coq &gt;= 8.5.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">B</span> := bb.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">C</span> := cc.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">A</span> :=
| mkA1 : B -&gt; A
| mkA2 : C -&gt; A.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">id</span> (<span class="nv">a</span> : A) : A :=
  <span class="kr">match</span> a <span class="kr">with</span>
  | mkA1 b =&gt; mkA1 b
  | mkA2 c =&gt; mkA2 c
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Record</span> <span class="nf">duplicate_prod</span> (<span class="nv">A</span> <span class="nv">B</span> : <span class="kt">Type</span>) :=
  duplicate_conj { duplicate_fst : A ; duplicate_snd : B }.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">HERE</span> := <span class="kt">True</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">start_remove_duplicates</span> :=
  <span class="nb">simple refine</span> (<span class="kr">let</span> <span class="nv">H___duplicates</span> := @duplicate_conj _ _ I _ <span class="kr">in</span> _);
  [ <span class="nb">shelve</span> | | ]; <span class="nb">cycle</span> <span class="mi">1</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">find_dup</span> H G :=
  <span class="kr">lazymatch</span> <span class="kp">type of</span> H <span class="kr">with</span>
  | duplicate_prod G _ =&gt; <span class="kp">constr</span>:(@duplicate_fst _ _ H)
  | duplicate_prod _ _ =&gt; find_dup (@duplicate_snd _ _ H) G
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">find_end</span> H :=
  <span class="kr">lazymatch</span> <span class="kp">type of</span> H <span class="kr">with</span>
  | duplicate_prod _ _ =&gt; find_end (@duplicate_snd _ _ H)
  | _ =&gt; H
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">revert_until</span> H :=
  <span class="kp">repeat</span> <span class="kr">lazymatch goal with</span>
         | [ H&#39; : _ |- _ ]
           =&gt; <span class="kp">first</span> [ <span class="nb">constr_eq</span> H H&#39;; <span class="kp">fail</span> <span class="mi">1</span>
                    | <span class="nb">revert</span> H&#39; ]
         <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">remove_duplicates</span> :=
  [ &gt; <span class="kr">lazymatch goal with</span>
      | [ |- duplicate_prod _ _ ] =&gt; <span class="kp">idtac</span>
      | [ H : duplicate_prod _ _ |- _ ]
        =&gt; <span class="nb">generalize</span> (I : HERE);
           revert_until H;
           <span class="kr">let</span> <span class="nv">G</span> := <span class="kr">match goal with</span> |- <span class="nl">?G</span> =&gt; G <span class="kr">end</span> <span class="kr">in</span>
           <span class="kr">lazymatch</span> <span class="kp">type of</span> H <span class="kr">with</span>
           | <span class="kp">context</span>[duplicate_prod G]
             =&gt; <span class="kr">let</span> <span class="nv">lem</span> := find_dup H G <span class="kr">in</span> <span class="bp">exact</span> lem
           | _ =&gt; <span class="kr">let</span> <span class="nv">lem</span> := find_end H <span class="kr">in</span>
                  <span class="nb">refine</span> (@duplicate_fst _ _ lem); <span class="nb">clear</span> H;
                  <span class="c">(* clear to work around a bug in Coq *)</span>
                  <span class="nb">shelve</span>
           <span class="kr">end</span>
      <span class="kr">end</span>.. ].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">finish_duplicates</span> :=
  [ &gt; <span class="kr">lazymatch goal with</span>
      | [ H : duplicate_prod _ _ |- _ ] =&gt; <span class="nb">clear</span> H
      <span class="kr">end</span>..
  | <span class="kp">repeat</span> <span class="kr">match goal with</span>
           | [ |- duplicate_prod _ <span class="nl">?e</span> ]
             =&gt; <span class="nb">split</span>;
                [ <span class="kp">repeat</span> <span class="kr">lazymatch goal with</span>
                         | [ |- HERE -&gt; _ ] =&gt; <span class="kp">fail</span>
                         | _ =&gt; <span class="nb">intro</span>
                         <span class="kr">end</span>;
                  <span class="nb">intros</span> _
                | <span class="kp">try</span> (<span class="nb">is_evar</span> e; <span class="bp">exact</span> I) ]
           <span class="kr">end</span> ].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chkb"><span class="kn">Theorem</span> <span class="nf">Foo</span> :
  <span class="kr">forall</span>  <span class="nv">a1</span> <span class="nv">a2</span> : A , a1 &lt;&gt; a2 -&gt; id a1 &lt;&gt; id a2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a1</span> <span class="nv">a2</span> : A, a1 &lt;&gt; a2 -&gt; id a1 &lt;&gt; id a2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chkc"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a1</span> <span class="nv">a2</span> : A, a1 &lt;&gt; a2 -&gt; id a1 &lt;&gt; id a2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chkd">start_remove_duplicates.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H___duplicates</var><span><span class="hyp-body"><b>:= </b><span>{|
  duplicate_fst := I;
  duplicate_snd := <span class="nl">?duplicate_snd</span>
|}</span></span><span class="hyp-type"><b>: </b><span>duplicate_prod <span class="kt">True</span> <span class="nl">?B</span></span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a1</span> <span class="nv">a2</span> : A, a1 &lt;&gt; a2 -&gt; id a1 &lt;&gt; id a2</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nl">?B</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chke"><span class="nb">destruct</span> a1; <span class="nb">destruct</span> a2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H___duplicates</var><span><span class="hyp-body"><b>:= </b><span>{|
  duplicate_fst := I;
  duplicate_snd := <span class="nl">?duplicate_snd</span>
|}</span></span><span class="hyp-type"><b>: </b><span>duplicate_prod <span class="kt">True</span> <span class="nl">?B</span></span></span></span></span><br><span><var>b, b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mkA1 b &lt;&gt; mkA1 b0 -&gt; id (mkA1 b) &lt;&gt; id (mkA1 b0)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chkf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H___duplicates</var><span><span class="hyp-body"><b>:= </b><span>{|
  duplicate_fst := I;
  duplicate_snd := <span class="nl">?duplicate_snd</span>
|}</span></span><span class="hyp-type"><b>: </b><span>duplicate_prod <span class="kt">True</span> <span class="nl">?B</span></span></span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chkf"><hr></label><div class="goal-conclusion">mkA1 b &lt;&gt; mkA2 c -&gt; id (mkA1 b) &lt;&gt; id (mkA2 c)</div></blockquote><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk10" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H___duplicates</var><span><span class="hyp-body"><b>:= </b><span>{|
  duplicate_fst := I;
  duplicate_snd := <span class="nl">?duplicate_snd</span>
|}</span></span><span class="hyp-type"><b>: </b><span>duplicate_prod <span class="kt">True</span> <span class="nl">?B</span></span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk10"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA1 b -&gt; id (mkA2 c) &lt;&gt; id (mkA1 b)</div></blockquote><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk11" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H___duplicates</var><span><span class="hyp-body"><b>:= </b><span>{|
  duplicate_fst := I;
  duplicate_snd := <span class="nl">?duplicate_snd</span>
|}</span></span><span class="hyp-type"><b>: </b><span>duplicate_prod <span class="kt">True</span> <span class="nl">?B</span></span></span></span></span><br><span><var>c, c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk11"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA2 c0 -&gt; id (mkA2 c) &lt;&gt; id (mkA2 c0)</div></blockquote><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nl">?B</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk12"><span class="mi">2</span>: <span class="nb">intro</span>; <span class="nb">apply</span> not_eq_sym <span class="kr">in</span> H; <span class="nb">apply</span> not_eq_sym; <span class="nb">revert</span> c b H; <span class="nb">intros</span> c b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H___duplicates</var><span><span class="hyp-body"><b>:= </b><span>{|
  duplicate_fst := I;
  duplicate_snd := <span class="nl">?duplicate_snd</span>
|}</span></span><span class="hyp-type"><b>: </b><span>duplicate_prod <span class="kt">True</span> <span class="nl">?B</span></span></span></span></span><br><span><var>b, b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mkA1 b &lt;&gt; mkA1 b0 -&gt; id (mkA1 b) &lt;&gt; id (mkA1 b0)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk13" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H___duplicates</var><span><span class="hyp-body"><b>:= </b><span>{|
  duplicate_fst := I;
  duplicate_snd := <span class="nl">?duplicate_snd</span>
|}</span></span><span class="hyp-type"><b>: </b><span>duplicate_prod <span class="kt">True</span> <span class="nl">?B</span></span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk13"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA1 b -&gt; id (mkA2 c) &lt;&gt; id (mkA1 b)</div></blockquote><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk14" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H___duplicates</var><span><span class="hyp-body"><b>:= </b><span>{|
  duplicate_fst := I;
  duplicate_snd := <span class="nl">?duplicate_snd</span>
|}</span></span><span class="hyp-type"><b>: </b><span>duplicate_prod <span class="kt">True</span> <span class="nl">?B</span></span></span></span></span><br><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk14"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA1 b -&gt; id (mkA2 c) &lt;&gt; id (mkA1 b)</div></blockquote><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk15" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H___duplicates</var><span><span class="hyp-body"><b>:= </b><span>{|
  duplicate_fst := I;
  duplicate_snd := <span class="nl">?duplicate_snd</span>
|}</span></span><span class="hyp-type"><b>: </b><span>duplicate_prod <span class="kt">True</span> <span class="nl">?B</span></span></span></span></span><br><span><var>c, c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk15"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA2 c0 -&gt; id (mkA2 c) &lt;&gt; id (mkA2 c0)</div></blockquote><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="nl">?B</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk16"><span class="kp">all</span>: remove_duplicates.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">duplicate_prod
  (<span class="kr">forall</span> <span class="nv">b</span> <span class="nv">b0</span> : B,
   HERE -&gt;
   mkA1 b &lt;&gt; mkA1 b0 -&gt; id (mkA1 b) &lt;&gt; id (mkA1 b0))
  (duplicate_prod
     (<span class="kr">forall</span> (<span class="nv">c</span> : C) (<span class="nv">b</span> : B),
      HERE -&gt;
      mkA2 c &lt;&gt; mkA1 b -&gt; id (mkA2 c) &lt;&gt; id (mkA1 b))
     (duplicate_prod
        (<span class="kr">forall</span> <span class="nv">c</span> <span class="nv">c0</span> : C,
         HERE -&gt;
         mkA2 c &lt;&gt; mkA2 c0 -&gt;
         id (mkA2 c) &lt;&gt; id (mkA2 c0)) 
        <span class="nl">?Goal</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk17"><span class="kp">all</span>: finish_duplicates.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>b, b0</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">mkA1 b &lt;&gt; mkA1 b0 -&gt; id (mkA1 b) &lt;&gt; id (mkA1 b0)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk18" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>B</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk18"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA1 b -&gt; id (mkA2 c) &lt;&gt; id (mkA1 b)</div></blockquote><input class="alectryon-extra-goal-toggle" id="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk19" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c, c0</var><span class="hyp-type"><b>: </b><span>C</span></span></span><br></div><label class="goal-separator" for="eliminate-redundant-sub-goals-generated-by-case-analysis-in-coq-v-chk19"><hr></label><div class="goal-conclusion">mkA2 c &lt;&gt; mkA2 c0 -&gt; id (mkA2 c) &lt;&gt; id (mkA2 c0)</div></blockquote></div></div></div></small></span></pre><p>The idea is that you first create an evar that will hold the solutions
to unique goals. Then you do the case analysis. Then you go through
the goals, and solve them either with a fresh projection from the
evar, or, if you see that there's already a solution to the goal
you're looking at, you use that solution. Finally, you split up the
evar into multiple (deduplicated) goals. There's some additional
boilerplate around reverting hypotheses that didn't exist when you
created the evar (necessary to appease variable scoping for well-typed
terms), remembering which things came from the context originally, and
reintroducing those things back into the context at the end.</p>
</section>
</div>
</main>
</div></body>
</html>
