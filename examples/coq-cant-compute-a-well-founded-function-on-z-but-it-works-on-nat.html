<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<title>Coq can't compute a well-founded function on Z, but it works on nat</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><div class="document" id="coq-can-t-compute-a-well-founded-function-on-z-but-it-works-on-nat">
<h1 class="title">Coq can't compute a well-founded function on <tt class="docutils literal">Z</tt>, but it works on <tt class="docutils literal">nat</tt></h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr class="link field"><th class="docinfo-name">Link:</th><td class="field-body"><a class="reference external" href="https://stackoverflow.com/q/44186751">https://stackoverflow.com/q/44186751</a></td>
</tr>
</tbody>
</table>
<input type="checkbox" class="alectryon-toggle" id="alectryon-toggle-0" /><label for="alectryon-toggle-0" class="alectryon-toggle-label">Display all goals and responses</label><div class="alectryon-container docutils container">
<div class="section" id="question">
<h1>Question</h1>
<p>I'm writing (for myself) an explanation of how to do well-founded
recursion in Coq. (see i.e. the Coq'Art book, chapter 15.2). First I
made an example function based on <tt class="docutils literal">nat</tt> and that worked fine, but
then I did it again for <tt class="docutils literal">Z</tt>, and when I use <tt class="docutils literal">Compute</tt> to evaluate
it, it doesn't reduce all the way down to a <tt class="docutils literal">Z</tt> value. Why?</p>
<p>Here is my example (I put the text inside comments so one can
copy-paste the whole thing into your editor):</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="c">(* Test of well-founded recursion *)</span>

<span class="c">(* TL;DR: To do well-founded recursion, first create &#39;functional&#39; and</span>
<span class="c">then create the recursive function using Acc_iter, the iterator for</span>
<span class="c">accessible relations *)</span>

<span class="c">(* As an example, compute the sum of the series from 1 to n, something</span>
<span class="c">like this sketch:</span>

<span class="c">fix f n := (if n = 0 then 0 else n + f (n-1))</span>

<span class="c">Now, let&#39;s not use structural recursion on n.</span>

<span class="c">Instead, we use well-founded recursion on n, using that the relation</span>
<span class="c">less-than (&#39;lt&#39;) is wellfounded. The function f terminates because the</span>
<span class="c">recursive call is made on a structurally smaller term (in the</span>
<span class="c">decreasing Acc-chain). *)</span>

<span class="c">(* First we do it for nat *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Arith.Arith.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Program.Utils. <span class="c">(* for &#39;dec&#39; *)</span></span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Wellfounded.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* From a proof that a relation is wellfounded, we can get a proof</span>
<span class="c">that a particular element in its domain is accessible.</span>

<span class="c">The Check commands here are not necessary, just for documentation,</span>
<span class="c">dear reader. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk0"><span class="kn">Check</span> well_founded : <span class="kr">forall</span> <span class="nv">A</span> : <span class="kt">Type</span>, (A -&gt; A -&gt; <span class="kt">Prop</span>) -&gt; <span class="kt">Prop</span>.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">well_founded
:
<span class="kr">forall</span> <span class="nv">A</span> : <span class="kt">Type</span>, (A -&gt; A -&gt; <span class="kt">Prop</span>) -&gt; <span class="kt">Prop</span>
     : <span class="kr">forall</span> <span class="nv">A</span> : <span class="kt">Type</span>, (A -&gt; A -&gt; <span class="kt">Prop</span>) -&gt; <span class="kt">Prop</span></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk1"><span class="kn">Check</span> lt_wf : well_founded lt.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">lt_wf : well_founded lt
     : well_founded lt</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk2"><span class="kn">Check</span> (lt_wf <span class="mi">4711</span> : Acc lt <span class="mi">4711</span>).</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">lt_wf <span class="mi">4711</span> : Acc lt <span class="mi">4711</span>
     : Acc lt <span class="mi">4711</span></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* First define a &#39;functional&#39; F for f. It is a function that takes a</span>
<span class="c">function F_rec for the &#39;recursive call&#39; as an argument. Because we</span>
<span class="c">need to know n &lt;&gt; 0 in the second branch we use &#39;dec&#39; to turn the</span>
<span class="c">boolean if-condition into a sumbool. This we get info about it into</span>
<span class="c">the branches.</span>

<span class="c">We write most of it with refine, and leave some holes to be filled in</span>
<span class="c">with tactics later. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk3"><span class="kn">Definition</span> <span class="nf">F</span> (<span class="nv">n</span> : nat) (<span class="nv">F_rec</span> : (<span class="kr">forall</span> <span class="nv">y</span> : nat, y &lt; n -&gt; nat)) : nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>F_rec</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">y</span> : nat, y &lt; n -&gt; nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nat</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk4"><span class="nb">refine</span> (<span class="kr">if</span> dec (n =? <span class="mi">0</span>) <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> n + (F_rec (n - <span class="mi">1</span>) _ )).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>F_rec</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">y</span> : nat, y &lt; n -&gt; nat</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>(n =? <span class="mi">0</span>) = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n - <span class="mi">1</span> &lt; n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* now we need to show that n-1 &lt; n, which is true for nat if n&lt;&gt;0 *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> n; <span class="bp">now</span> <span class="nb">auto with</span> *.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Defined</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* The functional can be used by an iterator to call f as many times</span>
<span class="c">as is needed.</span>

<span class="c">Side note: One can either make an iterator that takes the maximal</span>
<span class="c">recursive depth d as a nat argument, and recurses on d, but then one</span>
<span class="c">has to provide d, and also a &#39;default value&#39; to return in case d</span>
<span class="c">reaches zero and one must terminate early.</span>

<span class="c">The neat thing with well-founded recursion is that the iterator can</span>
<span class="c">recurse on the proof of wellfoundedness and doesnt need any other</span>
<span class="c">structure or default value to guarantee it will terminate. *)</span>

<span class="c">(* The type of Acc_iter is pretty hairy *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk5"><span class="kn">Check</span> Acc_iter :
  <span class="kr">forall</span> (<span class="nv">A</span> : <span class="kt">Type</span>) (<span class="nv">R</span> : A -&gt; A -&gt; <span class="kt">Prop</span>) (<span class="nv">P</span> : A -&gt; <span class="kt">Type</span>),
    (<span class="kr">forall</span> <span class="nv">x</span> : A, (<span class="kr">forall</span> <span class="nv">y</span> : A, R y x -&gt; P y) -&gt; P x) -&gt;
    <span class="kr">forall</span> <span class="nv">x</span> : A, Acc R x -&gt; P x.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Fix_F
:
<span class="kr">forall</span> (<span class="nv">A</span> : <span class="kt">Type</span>) (<span class="nv">R</span> : A -&gt; A -&gt; <span class="kt">Prop</span>) (<span class="nv">P</span> : A -&gt; <span class="kt">Type</span>),
(<span class="kr">forall</span> <span class="nv">x</span> : A, (<span class="kr">forall</span> <span class="nv">y</span> : A, R y x -&gt; P y) -&gt; P x) -&gt;
<span class="kr">forall</span> <span class="nv">x</span> : A, Acc R x -&gt; P x
     : <span class="kr">forall</span> (<span class="nv">A</span> : <span class="kt">Type</span>) (<span class="nv">R</span> : A -&gt; A -&gt; <span class="kt">Prop</span>)
         (<span class="nv">P</span> : A -&gt; <span class="kt">Type</span>),
       (<span class="kr">forall</span> <span class="nv">x</span> : A,
        (<span class="kr">forall</span> <span class="nv">y</span> : A, R y x -&gt; P y) -&gt; P x) -&gt;
       <span class="kr">forall</span> <span class="nv">x</span> : A, Acc R x -&gt; P x</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* P is there because the return type could be dependent on the</span>
<span class="c">argument, but in our case, f:nat-&gt;nat, and R = lt, so we have *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk6"><span class="kn">Check</span> Acc_iter (R:=lt) (<span class="kr">fun</span> <span class="nv">_</span>:nat=&gt;nat) :
  (<span class="kr">forall</span> <span class="nv">n</span> : nat, (<span class="kr">forall</span> <span class="nv">y</span> : nat, y &lt; n -&gt; nat) -&gt; nat) -&gt;
  <span class="kr">forall</span> <span class="nv">n</span> : nat, Acc lt n -&gt; nat.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Fix_F (<span class="kr">fun</span> <span class="nv">_</span> : nat =&gt; nat)
:
(<span class="kr">forall</span> <span class="nv">n</span> : nat, (<span class="kr">forall</span> <span class="nv">y</span> : nat, y &lt; n -&gt; nat) -&gt; nat) -&gt;
<span class="kr">forall</span> <span class="nv">n</span> : nat, Acc lt n -&gt; nat
     : (<span class="kr">forall</span> <span class="nv">n</span> : nat,
        (<span class="kr">forall</span> <span class="nv">y</span> : nat, y &lt; n -&gt; nat) -&gt; nat) -&gt;
       <span class="kr">forall</span> <span class="nv">n</span> : nat, Acc lt n -&gt; nat</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Here the first argument is the functional that the iterator takes,</span>
<span class="c">the second argument n is the input to f, and the third argument is a</span>
<span class="c">proof that n is accessible. The iterator returns the value of f</span>
<span class="c">applied to n.</span>

<span class="c">Several of Acc_iter&#39;s arguments are implicit, and some can be</span>
<span class="c">inferred. Thus we can define f simply as follows: *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">f</span> <span class="nv">n</span> := Acc_iter _ F (lt_wf n).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* It works like a charm *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk7"><span class="kn">Compute</span> (f <span class="mi">50</span>). <span class="c">(* This prints 1275 *)</span></label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">= <span class="mi">1275</span>
: (<span class="kr">fun</span> <span class="nv">_</span> : nat =&gt; nat) <span class="mi">50</span></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk8"><span class="kn">Check</span> eq_refl : f <span class="mi">50</span> = <span class="mi">1275</span>.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">eq_refl : f <span class="mi">50</span> = <span class="mi">1275</span>
     : f <span class="mi">50</span> = <span class="mi">1275</span></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Now let&#39;s do it for Z. Here we can&#39;t use lt, or lt_wf because they</span>
<span class="c">are for nat. For Z we can use Zle and (Zwf c) which takes a lower</span>
<span class="c">bound. It needs a lower bound under which we know that the function</span>
<span class="c">will always terminate to guarantee termination. Here we use (Zwf 0) to</span>
<span class="c">say that our function will always terminate at or below 0. We also</span>
<span class="c">have to change the if-statement to &#39;if n &lt;= 0 then 0 else ...&#39; so we</span>
<span class="c">return zero for arguments less than zero. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> ZArith.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Zwf.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Open Scope</span> Z.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Now we define the function g based on the functional G *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk9"><span class="kn">Definition</span> <span class="nf">G</span> (<span class="nv">n</span> : Z) (<span class="nv">G_rec</span> : (<span class="kr">forall</span> <span class="nv">y</span> : Z, Zwf <span class="mi">0</span> y n -&gt; Z)) : Z.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>G_rec</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">y</span> : Z, Zwf <span class="mi">0</span> y n -&gt; Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Z</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chka"><span class="nb">refine</span> (<span class="kr">if</span> dec (n &lt;? <span class="mi">0</span>) <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> n + (G_rec (n - <span class="mi">1</span>) _ )).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>G_rec</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">y</span> : Z, Zwf <span class="mi">0</span> y n -&gt; Z</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>(n &lt;? <span class="mi">0</span>) = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Zwf <span class="mi">0</span> (n - <span class="mi">1</span>) n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* now we need to show that n-1 &lt; n *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">split</span>; [<span class="nb">apply</span> Z.ltb_ge | <span class="nb">apply</span> Z.lt_sub_pos].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Defined</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">g</span> <span class="nv">n</span> := Acc_iter _ G (Zwf_well_founded <span class="mi">0</span> n).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* But now we can&#39;t compute! *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chkb"><span class="kn">Compute</span> (g <span class="mi">1</span>).</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">= (<span class="kr">fix</span> Ffix
     (x : Z)
     (x0 : Acc
             (<span class="kr">fun</span> <span class="nv">x0</span> <span class="nv">x1</span> : Z =&gt;
              (<span class="kr">match</span> x1 <span class="kr">with</span>
               | <span class="mi">0</span> =&gt; Eq
               | Z.pos _ =&gt; Lt
               | Z.neg _ =&gt; Gt
               <span class="kr">end</span> = Gt -&gt; <span class="kt">False</span>) /\
              <span class="kr">match</span> x0 <span class="kr">with</span>
              | <span class="mi">0</span> =&gt;
                  <span class="kr">match</span> x1 <span class="kr">with</span>
                  | <span class="mi">0</span> =&gt; Eq
                  | Z.pos _ =&gt; Lt
                  | Z.neg _ =&gt; Gt
                  <span class="kr">end</span>
              | Z.pos x2 =&gt;
                  <span class="kr">match</span> x1 <span class="kr">with</span>
                  | Z.pos x3 =&gt;
                      (<span class="kr">fix</span> Ffix0
                         (x4 : comparison)
                         (x5 x6 : positive)
                         {<span class="kr">struct</span> x6} :
                           comparison :=
                         <span class="kr">match</span> x5 <span class="kr">with</span>
                         | (x7~<span class="mi">1</span>)%positive =&gt;
                             <span class="kr">match</span> x6 <span class="kr">with</span>
                             | (x8~<span class="mi">1</span>)%positive =&gt;
                                 Ffix0 x4 x7 x8
                             | (x8~<span class="mi">0</span>)%positive =&gt;
                                 Ffix0 Gt x7 x8
                             | <span class="mi">1</span>%positive =&gt; Gt
                             <span class="kr">end</span>
                         | (x7~<span class="mi">0</span>)%positive =&gt;
                             <span class="kr">match</span> x6 <span class="kr">with</span>
                             | (x8~<span class="mi">1</span>)%positive =&gt;
                                 Ffix0 Lt x7 x8
                             | (x8~<span class="mi">0</span>)%positive =&gt;
                                 Ffix0 x4 x7 x8
                             | <span class="mi">1</span>%positive =&gt; Gt
                             <span class="kr">end</span>
                         | <span class="mi">1</span>%positive =&gt;
                             <span class="kr">match</span> x6 <span class="kr">with</span>
                             | <span class="mi">1</span>%positive =&gt; x4
                             | _ =&gt; Lt
                             <span class="kr">end</span>
                         <span class="kr">end</span>) Eq x2 x3
                  | _ =&gt; Gt
                  <span class="kr">end</span>
              | Z.neg x2 =&gt;
                  <span class="kr">match</span> x1 <span class="kr">with</span>
                  | Z.neg x3 =&gt;
                      <span class="kr">match</span>
                        (<span class="kr">fix</span> Ffix0
                           (x4 : comparison)
                           (x5 x6 : positive)
                           {<span class="kr">struct</span> x6} :
                             comparison :=
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> ... <span class="kr">with</span>
                               | ... =&gt;
                                   Ffix0 x4 x7 x8
                               | ... =&gt;
                                   Ffix0 Gt x7 x8
                               | ... =&gt; Gt
                               <span class="kr">end</span>
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> ... <span class="kr">with</span>
                               | ... =&gt;
                                   Ffix0 Lt x7 x8
                               | ... =&gt;
                                   Ffix0 x4 x7 x8
                               | ... =&gt; Gt
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> ... <span class="kr">with</span>
                               | ... =&gt; x4
                               | ... =&gt; Lt
                               <span class="kr">end</span>
                           <span class="kr">end</span>) Eq x2 x3
                      <span class="kr">with</span>
                      | Eq =&gt; Eq
                      | Lt =&gt; Gt
                      | Gt =&gt; Lt
                      <span class="kr">end</span>
                  | _ =&gt; Lt
                  <span class="kr">end</span>
              <span class="kr">end</span> = Lt) x) {<span class="kr">struct</span> x0} : Z :=
     <span class="kr">match</span>
       (<span class="kr">if</span>
         <span class="kr">match</span>
           <span class="kr">match</span> x <span class="kr">with</span>
           | <span class="mi">0</span> =&gt; Eq
           | Z.pos _ =&gt; Gt
           | Z.neg _ =&gt; Lt
           <span class="kr">end</span>
         <span class="kr">with</span>
         | Lt =&gt; true
         | _ =&gt; false
         <span class="kr">end</span> <span class="kr">as</span> c
         <span class="kr">return</span> ({c = true} + {c = false})
        <span class="kr">then</span> in_left
        <span class="kr">else</span> in_right)
     <span class="kr">with</span>
     | in_left =&gt; <span class="mi">0</span>
     | <span class="nb">right</span> x1 =&gt;
         <span class="kr">match</span> x <span class="kr">with</span>
         | <span class="mi">0</span> =&gt;
             Ffix
               <span class="kr">match</span> x <span class="kr">with</span>
               | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
               | Z.pos x3~<span class="mi">1</span> =&gt; Z.pos x3~<span class="mi">0</span>
               | Z.pos x3~<span class="mi">0</span> =&gt;
                   Z.pos
                     ((<span class="kr">fix</span> Ffix0
                         (x4 : positive) :
                           positive :=
                         <span class="kr">match</span> x4 <span class="kr">with</span>
                         | (x5~<span class="mi">1</span>)%positive =&gt;
                             (x5~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                         | (x5~<span class="mi">0</span>)%positive =&gt;
                             ((Ffix0 x5)~<span class="mi">1</span>)%positive
                         | <span class="mi">1</span>%positive =&gt;
                             <span class="mi">1</span>%positive
                         <span class="kr">end</span>) x3)
               | <span class="mi">1</span> =&gt; <span class="mi">0</span>
               | Z.neg x2 =&gt;
                   Z.neg
                     ((<span class="kr">with</span> Ffix0
                         (x3 x4 : positive)
                         {<span class="kr">struct</span> x3} :
                           positive :=
                         <span class="kr">match</span> x3 <span class="kr">with</span>
                         | (x5~<span class="mi">1</span>)%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x6~<span class="mi">1</span>)%positive =&gt;
                                 ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                             | (x6~<span class="mi">0</span>)%positive =&gt;
                                 ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                             <span class="kr">end</span>
                         | (x5~<span class="mi">0</span>)%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x6~<span class="mi">1</span>)%positive =&gt;
                                 ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                             | (x6~<span class="mi">0</span>)%positive =&gt;
                                 ((Ffix0 x5 x6)~<span class="mi">0</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 (x5~<span class="mi">1</span>)%positive
                             <span class="kr">end</span>
                         | <span class="mi">1</span>%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x5~<span class="mi">1</span>)%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                             | (x5~<span class="mi">0</span>)%positive =&gt;
                                 (x5~<span class="mi">1</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 <span class="mi">2</span>%positive
                             <span class="kr">end</span>
                         <span class="kr">end</span>
                       <span class="kr">with</span> Ffix1
                         (x3 x4 : positive)
                         {<span class="kr">struct</span> x3} :
                           positive :=
                         <span class="kr">match</span> x3 <span class="kr">with</span>
                         | (x5~<span class="mi">1</span>)%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x6~<span class="mi">1</span>)%positive =&gt;
                                 ((Ffix1 x5 x6)~<span class="mi">1</span>)%positive
                             | (x6~<span class="mi">0</span>)%positive =&gt;
                                 ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">1</span>)%positive
                             <span class="kr">end</span>
                         | (x5~<span class="mi">0</span>)%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x6~<span class="mi">1</span>)%positive =&gt;
                                 ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                             | (x6~<span class="mi">0</span>)%positive =&gt;
                                 ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                             <span class="kr">end</span>
                         | <span class="mi">1</span>%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x5~<span class="mi">1</span>)%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">1</span>)%positive
                             | (x5~<span class="mi">0</span>)%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 <span class="mi">3</span>%positive
                             <span class="kr">end</span>
                         <span class="kr">end</span>
                       <span class="kr">for</span>
                       Ffix0) x2 <span class="mi">1</span>%positive)
               <span class="kr">end</span>
               (<span class="kr">match</span> x0 <span class="kr">with</span>
                | Acc_intro _ x2 =&gt; x2
                <span class="kr">end</span>
                  <span class="kr">match</span> x <span class="kr">with</span>
                  | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                  | Z.pos x3~<span class="mi">1</span> =&gt; Z.pos x3~<span class="mi">0</span>
                  | Z.pos x3~<span class="mi">0</span> =&gt;
                      Z.pos
                        ((<span class="kr">fix</span> Ffix0
                            (x4 : positive) :
                              positive :=
                            <span class="kr">match</span> x4 <span class="kr">with</span>
                            | (x5~<span class="mi">1</span>)%positive =&gt;
                                (x5~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                            | (x5~<span class="mi">0</span>)%positive =&gt;
                                ((Ffix0 x5)~<span class="mi">1</span>)%positive
                            | <span class="mi">1</span>%positive =&gt;
                                <span class="mi">1</span>%positive
                            <span class="kr">end</span>) x3)
                  | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                  | Z.neg x2 =&gt;
                      Z.neg
                        ((<span class="kr">with</span> Ffix0
                            (x3 x4 : positive)
                            {<span class="kr">struct</span> x3} :
                              positive :=
                            <span class="kr">match</span> x3 <span class="kr">with</span>
                            | (x5~<span class="mi">1</span>)%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x6~<span class="mi">1</span>)%positive =&gt;
                                    ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                                | (x6~<span class="mi">0</span>)%positive =&gt;
                                    ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                                <span class="kr">end</span>
                            | (x5~<span class="mi">0</span>)%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x6~<span class="mi">1</span>)%positive =&gt;
                                    ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                                | (x6~<span class="mi">0</span>)%positive =&gt;
                                    ((Ffix0 x5 x6)~<span class="mi">0</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    (x5~<span class="mi">1</span>)%positive
                                <span class="kr">end</span>
                            | <span class="mi">1</span>%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x5~<span class="mi">1</span>)%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                                | (x5~<span class="mi">0</span>)%positive =&gt;
                                    (x5~<span class="mi">1</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    <span class="mi">2</span>%positive
                                <span class="kr">end</span>
                            <span class="kr">end</span>
                          <span class="kr">with</span> Ffix1
                            (x3 x4 : positive)
                            {<span class="kr">struct</span> x3} :
                              positive :=
                            <span class="kr">match</span> x3 <span class="kr">with</span>
                            | (x5~<span class="mi">1</span>)%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x6~<span class="mi">1</span>)%positive =&gt;
                                    ((Ffix1 x5 x6)~<span class="mi">1</span>)%positive
                                | (x6~<span class="mi">0</span>)%positive =&gt;
                                    ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">1</span>)%positive
                                <span class="kr">end</span>
                            | (x5~<span class="mi">0</span>)%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x6~<span class="mi">1</span>)%positive =&gt;
                                    ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                                | (x6~<span class="mi">0</span>)%positive =&gt;
                                    ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                                <span class="kr">end</span>
                            | <span class="mi">1</span>%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x5~<span class="mi">1</span>)%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">1</span>)%positive
                                | (x5~<span class="mi">0</span>)%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    <span class="mi">3</span>%positive
                                <span class="kr">end</span>
                            <span class="kr">end</span>
                          <span class="kr">for</span>
                          Ffix0) x2 <span class="mi">1</span>%positive)
                  <span class="kr">end</span>
                  (conj
                     (<span class="kr">match</span> Z.ltb_ge x <span class="mi">0</span> <span class="kr">with</span>
                      | conj x2 _ =&gt; x2
                      <span class="kr">end</span> x1)
                     (<span class="kr">match</span> Z.lt_sub_pos x <span class="mi">1</span> <span class="kr">with</span>
                      | conj x2 _ =&gt; x2
                      <span class="kr">end</span> eq_refl)))
         | Z.pos x2 =&gt;
             <span class="kr">match</span>
               Ffix
                 <span class="kr">match</span> x <span class="kr">with</span>
                 | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                 | Z.pos x4~<span class="mi">1</span> =&gt; Z.pos x4~<span class="mi">0</span>
                 | Z.pos x4~<span class="mi">0</span> =&gt;
                     Z.pos
                       ((<span class="kr">fix</span> Ffix0
                           (x5 : positive) :
                             positive :=
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (x6~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">1</span>%positive
                           <span class="kr">end</span>) x4)
                 | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                 | Z.neg x3 =&gt;
                     Z.neg
                       ((<span class="kr">with</span> Ffix0
                           (x4 x5 : positive)
                           {<span class="kr">struct</span> x4} :
                             positive :=
                           <span class="kr">match</span> x4 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               <span class="kr">end</span>
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (x6~<span class="mi">1</span>)%positive
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x6~<span class="mi">1</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               | (x6~<span class="mi">0</span>)%positive =&gt;
                                   (x6~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   <span class="mi">2</span>%positive
                               <span class="kr">end</span>
                           <span class="kr">end</span>
                         <span class="kr">with</span> Ffix1
                           (x4 x5 : positive)
                           {<span class="kr">struct</span> x4} :
                             positive :=
                           <span class="kr">match</span> x4 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">1</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">1</span>)%positive
                               <span class="kr">end</span>
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x6~<span class="mi">1</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">1</span>)%positive
                               | (x6~<span class="mi">0</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   <span class="mi">3</span>%positive
                               <span class="kr">end</span>
                           <span class="kr">end</span>
                         <span class="kr">for</span>
                         Ffix0) x3 <span class="mi">1</span>%positive)
                 <span class="kr">end</span>
                 (<span class="kr">match</span> x0 <span class="kr">with</span>
                  | Acc_intro _ x3 =&gt; x3
                  <span class="kr">end</span>
                    <span class="kr">match</span> x <span class="kr">with</span>
                    | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                    | Z.pos x4~<span class="mi">1</span> =&gt; Z.pos x4~<span class="mi">0</span>
                    | Z.pos x4~<span class="mi">0</span> =&gt;
                        Z.pos
                          ((<span class="kr">fix</span> Ffix0
                              (x5 : positive) :
                                positive :=
                              <span class="kr">match</span> x5 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  (x6~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  ((Ffix0 x6)~<span class="mi">1</span>)%positive
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="mi">1</span>%positive
                              <span class="kr">end</span>) x4)
                    | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                    | Z.neg x3 =&gt;
                        Z.neg
                          ((<span class="kr">with</span> Ffix0
                              (x4 x5 : positive)
                              {<span class="kr">struct</span> x4} :
                                positive :=
                              <span class="kr">match</span> x4 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  <span class="kr">end</span>
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      (x6~<span class="mi">1</span>)%positive
                                  <span class="kr">end</span>
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      (x6~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">2</span>%positive
                                  <span class="kr">end</span>
                              <span class="kr">end</span>
                            <span class="kr">with</span> Ffix1
                              (x4 x5 : positive)
                              {<span class="kr">struct</span> x4} :
                                positive :=
                              <span class="kr">match</span> x4 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  <span class="kr">end</span>
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  <span class="kr">end</span>
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">3</span>%positive
                                  <span class="kr">end</span>
                              <span class="kr">end</span>
                            <span class="kr">for</span>
                            Ffix0) x3 <span class="mi">1</span>%positive)
                    <span class="kr">end</span>
                    (conj
                       (<span class="kr">match</span> Z.ltb_ge x <span class="mi">0</span> <span class="kr">with</span>
                        | conj x3 _ =&gt; x3
                        <span class="kr">end</span> x1)
                       (<span class="kr">match</span>
                          Z.lt_sub_pos x <span class="mi">1</span>
                        <span class="kr">with</span>
                        | conj x3 _ =&gt; x3
                        <span class="kr">end</span> eq_refl)))
             <span class="kr">with</span>
             | <span class="mi">0</span> =&gt; x
             | Z.pos x3 =&gt;
                 Z.pos
                   ((<span class="kr">with</span> Ffix0
                       (x4 x5 : positive) {<span class="kr">struct</span>
                        x4} : positive :=
                       <span class="kr">match</span> x4 <span class="kr">with</span>
                       | (x6~<span class="mi">1</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           <span class="kr">end</span>
                       | (x6~<span class="mi">0</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (x6~<span class="mi">1</span>)%positive
                           <span class="kr">end</span>
                       | <span class="mi">1</span>%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               (x6~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">2</span>%positive
                           <span class="kr">end</span>
                       <span class="kr">end</span>
                     <span class="kr">with</span> Ffix1
                       (x4 x5 : positive) {<span class="kr">struct</span>
                        x4} : positive :=
                       <span class="kr">match</span> x4 <span class="kr">with</span>
                       | (x6~<span class="mi">1</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">1</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">1</span>)%positive
                           <span class="kr">end</span>
                       | (x6~<span class="mi">0</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           <span class="kr">end</span>
                       | <span class="mi">1</span>%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">1</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">3</span>%positive
                           <span class="kr">end</span>
                       <span class="kr">end</span>
                     <span class="kr">for</span>
                     Ffix0) x2 x3)
             | Z.neg x3 =&gt;
                 (<span class="kr">fix</span> Ffix0
                    (x4 x5 : positive) {<span class="kr">struct</span>
                     x5} : Z :=
                    <span class="kr">match</span> x4 <span class="kr">with</span>
                    | (x6~<span class="mi">1</span>)%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x7~<span class="mi">1</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">0</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">0</span>
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">0</span>
                            <span class="kr">end</span>
                        | (x7~<span class="mi">0</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">1</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">1</span>
                            | Z.neg x8 =&gt;
                                Z.neg
                                  ((<span class="kr">fix</span> Ffix1
                                      (x9 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        x9
                                      <span class="kr">with</span>
                                      | ...%positive =&gt;
                                          (x10~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                      | ...%positive =&gt;
                                          ((...)~<span class="mi">1</span>)%positive
                                      | <span class="mi">1</span>%positive =&gt;
                                          <span class="mi">1</span>%positive
                                      <span class="kr">end</span>) x8)
                            <span class="kr">end</span>
                        | <span class="mi">1</span>%positive =&gt;
                            Z.pos x6~<span class="mi">0</span>
                        <span class="kr">end</span>
                    | (x6~<span class="mi">0</span>)%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x7~<span class="mi">1</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                            | Z.pos x8 =&gt;
                                Z.pos
                                  ((<span class="kr">fix</span> Ffix1
                                      (x9 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        x9
                                      <span class="kr">with</span>
                                      | ...%positive =&gt;
                                          (x10~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                      | ...%positive =&gt;
                                          ((...)~<span class="mi">1</span>)%positive
                                      | <span class="mi">1</span>%positive =&gt;
                                          <span class="mi">1</span>%positive
                                      <span class="kr">end</span>) x8)
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">1</span>
                            <span class="kr">end</span>
                        | (x7~<span class="mi">0</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">0</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">0</span>
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">0</span>
                            <span class="kr">end</span>
                        | <span class="mi">1</span>%positive =&gt;
                            Z.pos
                              ((<span class="kr">fix</span> Ffix1
                                  (x7 : positive) :
                                    positive :=
                                  <span class="kr">match</span> x7 <span class="kr">with</span>
                                  | (x8~<span class="mi">1</span>)%positive =&gt;
                                      (x8~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                  | (x8~<span class="mi">0</span>)%positive =&gt;
                                      ((Ffix1 x8)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">1</span>%positive
                                  <span class="kr">end</span>) x6)
                        <span class="kr">end</span>
                    | <span class="mi">1</span>%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x6~<span class="mi">1</span>)%positive =&gt;
                            Z.neg x6~<span class="mi">0</span>
                        | (x6~<span class="mi">0</span>)%positive =&gt;
                            Z.neg
                              ((<span class="kr">fix</span> Ffix1
                                  (x7 : positive) :
                                    positive :=
                                  <span class="kr">match</span> x7 <span class="kr">with</span>
                                  | (x8~<span class="mi">1</span>)%positive =&gt;
                                      (x8~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                  | (x8~<span class="mi">0</span>)%positive =&gt;
                                      ((Ffix1 x8)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">1</span>%positive
                                  <span class="kr">end</span>) x6)
                        | <span class="mi">1</span>%positive =&gt; <span class="mi">0</span>
                        <span class="kr">end</span>
                    <span class="kr">end</span>) x2 x3
             <span class="kr">end</span>
         | Z.neg x2 =&gt;
             <span class="kr">match</span>
               Ffix
                 <span class="kr">match</span> x <span class="kr">with</span>
                 | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                 | Z.pos x4~<span class="mi">1</span> =&gt; Z.pos x4~<span class="mi">0</span>
                 | Z.pos x4~<span class="mi">0</span> =&gt;
                     Z.pos
                       ((<span class="kr">fix</span> Ffix0
                           (x5 : positive) :
                             positive :=
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (x6~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">1</span>%positive
                           <span class="kr">end</span>) x4)
                 | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                 | Z.neg x3 =&gt;
                     Z.neg
                       ((<span class="kr">with</span> Ffix0
                           (x4 x5 : positive)
                           {<span class="kr">struct</span> x4} :
                             positive :=
                           <span class="kr">match</span> x4 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               <span class="kr">end</span>
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (x6~<span class="mi">1</span>)%positive
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x6~<span class="mi">1</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               | (x6~<span class="mi">0</span>)%positive =&gt;
                                   (x6~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   <span class="mi">2</span>%positive
                               <span class="kr">end</span>
                           <span class="kr">end</span>
                         <span class="kr">with</span> Ffix1
                           (x4 x5 : positive)
                           {<span class="kr">struct</span> x4} :
                             positive :=
                           <span class="kr">match</span> x4 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">1</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">1</span>)%positive
                               <span class="kr">end</span>
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x6~<span class="mi">1</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">1</span>)%positive
                               | (x6~<span class="mi">0</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   <span class="mi">3</span>%positive
                               <span class="kr">end</span>
                           <span class="kr">end</span>
                         <span class="kr">for</span>
                         Ffix0) x3 <span class="mi">1</span>%positive)
                 <span class="kr">end</span>
                 (<span class="kr">match</span> x0 <span class="kr">with</span>
                  | Acc_intro _ x3 =&gt; x3
                  <span class="kr">end</span>
                    <span class="kr">match</span> x <span class="kr">with</span>
                    | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                    | Z.pos x4~<span class="mi">1</span> =&gt; Z.pos x4~<span class="mi">0</span>
                    | Z.pos x4~<span class="mi">0</span> =&gt;
                        Z.pos
                          ((<span class="kr">fix</span> Ffix0
                              (x5 : positive) :
                                positive :=
                              <span class="kr">match</span> x5 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  (x6~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  ((Ffix0 x6)~<span class="mi">1</span>)%positive
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="mi">1</span>%positive
                              <span class="kr">end</span>) x4)
                    | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                    | Z.neg x3 =&gt;
                        Z.neg
                          ((<span class="kr">with</span> Ffix0
                              (x4 x5 : positive)
                              {<span class="kr">struct</span> x4} :
                                positive :=
                              <span class="kr">match</span> x4 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  <span class="kr">end</span>
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      (x6~<span class="mi">1</span>)%positive
                                  <span class="kr">end</span>
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      (x6~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">2</span>%positive
                                  <span class="kr">end</span>
                              <span class="kr">end</span>
                            <span class="kr">with</span> Ffix1
                              (x4 x5 : positive)
                              {<span class="kr">struct</span> x4} :
                                positive :=
                              <span class="kr">match</span> x4 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  <span class="kr">end</span>
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  <span class="kr">end</span>
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">3</span>%positive
                                  <span class="kr">end</span>
                              <span class="kr">end</span>
                            <span class="kr">for</span>
                            Ffix0) x3 <span class="mi">1</span>%positive)
                    <span class="kr">end</span>
                    (conj
                       (<span class="kr">match</span> Z.ltb_ge x <span class="mi">0</span> <span class="kr">with</span>
                        | conj x3 _ =&gt; x3
                        <span class="kr">end</span> x1)
                       (<span class="kr">match</span>
                          Z.lt_sub_pos x <span class="mi">1</span>
                        <span class="kr">with</span>
                        | conj x3 _ =&gt; x3
                        <span class="kr">end</span> eq_refl)))
             <span class="kr">with</span>
             | <span class="mi">0</span> =&gt; x
             | Z.pos x3 =&gt;
                 (<span class="kr">fix</span> Ffix0
                    (x4 x5 : positive) {<span class="kr">struct</span>
                     x5} : Z :=
                    <span class="kr">match</span> x4 <span class="kr">with</span>
                    | (x6~<span class="mi">1</span>)%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x7~<span class="mi">1</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">0</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">0</span>
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">0</span>
                            <span class="kr">end</span>
                        | (x7~<span class="mi">0</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">1</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">1</span>
                            | Z.neg x8 =&gt;
                                Z.neg
                                  ((<span class="kr">fix</span> Ffix1
                                      (x9 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        x9
                                      <span class="kr">with</span>
                                      | ...%positive =&gt;
                                          (x10~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                      | ...%positive =&gt;
                                          ((...)~<span class="mi">1</span>)%positive
                                      | <span class="mi">1</span>%positive =&gt;
                                          <span class="mi">1</span>%positive
                                      <span class="kr">end</span>) x8)
                            <span class="kr">end</span>
                        | <span class="mi">1</span>%positive =&gt;
                            Z.pos x6~<span class="mi">0</span>
                        <span class="kr">end</span>
                    | (x6~<span class="mi">0</span>)%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x7~<span class="mi">1</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                            | Z.pos x8 =&gt;
                                Z.pos
                                  ((<span class="kr">fix</span> Ffix1
                                      (x9 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        x9
                                      <span class="kr">with</span>
                                      | ...%positive =&gt;
                                          (x10~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                      | ...%positive =&gt;
                                          ((...)~<span class="mi">1</span>)%positive
                                      | <span class="mi">1</span>%positive =&gt;
                                          <span class="mi">1</span>%positive
                                      <span class="kr">end</span>) x8)
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">1</span>
                            <span class="kr">end</span>
                        | (x7~<span class="mi">0</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">0</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">0</span>
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">0</span>
                            <span class="kr">end</span>
                        | <span class="mi">1</span>%positive =&gt;
                            Z.pos
                              ((<span class="kr">fix</span> Ffix1
                                  (x7 : positive) :
                                    positive :=
                                  <span class="kr">match</span> x7 <span class="kr">with</span>
                                  | (x8~<span class="mi">1</span>)%positive =&gt;
                                      (x8~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                  | (x8~<span class="mi">0</span>)%positive =&gt;
                                      ((Ffix1 x8)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">1</span>%positive
                                  <span class="kr">end</span>) x6)
                        <span class="kr">end</span>
                    | <span class="mi">1</span>%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x6~<span class="mi">1</span>)%positive =&gt;
                            Z.neg x6~<span class="mi">0</span>
                        | (x6~<span class="mi">0</span>)%positive =&gt;
                            Z.neg
                              ((<span class="kr">fix</span> Ffix1
                                  (x7 : positive) :
                                    positive :=
                                  <span class="kr">match</span> x7 <span class="kr">with</span>
                                  | (x8~<span class="mi">1</span>)%positive =&gt;
                                      (x8~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                  | (x8~<span class="mi">0</span>)%positive =&gt;
                                      ((Ffix1 x8)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">1</span>%positive
                                  <span class="kr">end</span>) x6)
                        | <span class="mi">1</span>%positive =&gt; <span class="mi">0</span>
                        <span class="kr">end</span>
                    <span class="kr">end</span>) x3 x2
             | Z.neg x3 =&gt;
                 Z.neg
                   ((<span class="kr">with</span> Ffix0
                       (x4 x5 : positive) {<span class="kr">struct</span>
                        x4} : positive :=
                       <span class="kr">match</span> x4 <span class="kr">with</span>
                       | (x6~<span class="mi">1</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           <span class="kr">end</span>
                       | (x6~<span class="mi">0</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (x6~<span class="mi">1</span>)%positive
                           <span class="kr">end</span>
                       | <span class="mi">1</span>%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               (x6~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">2</span>%positive
                           <span class="kr">end</span>
                       <span class="kr">end</span>
                     <span class="kr">with</span> Ffix1
                       (x4 x5 : positive) {<span class="kr">struct</span>
                        x4} : positive :=
                       <span class="kr">match</span> x4 <span class="kr">with</span>
                       | (x6~<span class="mi">1</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">1</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">1</span>)%positive
                           <span class="kr">end</span>
                       | (x6~<span class="mi">0</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           <span class="kr">end</span>
                       | <span class="mi">1</span>%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">1</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">3</span>%positive
                           <span class="kr">end</span>
                       <span class="kr">end</span>
                     <span class="kr">for</span>
                     Ffix0) x2 x3)
             <span class="kr">end</span>
         <span class="kr">end</span>
     <span class="kr">end</span>) <span class="mi">1</span> (Zwf_well_founded <span class="mi">0</span> <span class="mi">1</span>)
: (<span class="kr">fun</span> <span class="nv">_</span> : Z =&gt; Z) <span class="mi">1</span></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* We just get a huge a term *)</span></span></pre><p>Comment: I noticed that <tt class="docutils literal">Zwf_well_founded</tt> is defined as <tt class="docutils literal">Opaque</tt>
in the library, so I tried to make it <tt class="docutils literal">Transparent</tt> by copying the
proof and ending the lemma with <tt class="docutils literal">Defined.</tt> instead of <tt class="docutils literal">Qed.</tt> but
that didn't help...</p>
<p>Added observation:</p>
<p>If I define <tt class="docutils literal">f'</tt> for <tt class="docutils literal">nat</tt> with <tt class="docutils literal">Fixpoint</tt> instead, and recurse
on the accesibility proof, <em>and end with</em> <tt class="docutils literal">Defined</tt>. then it
computes. But if I end with <tt class="docutils literal">Qed.</tt>. it doesn't reduce. Is this
related? I guess there is an issue of transparency in the definition
of <tt class="docutils literal">G</tt> or <tt class="docutils literal">g</tt> somewhere... Or am I completely mistaken?</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chkc"><span class="kn">Fixpoint</span> <span class="nf">f&#39;</span> (<span class="nv">n</span> : nat) (<span class="nv">H</span>: Acc lt n) : nat.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>f'</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat, Acc lt n -&gt; nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Acc lt n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">nat</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chkd"><span class="nb">refine</span> (<span class="kr">if</span> dec (n &lt;=? <span class="mi">0</span>) <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> n + (f&#39; (n - <span class="mi">1</span>) (Acc_inv H _))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>f'</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat, Acc lt n -&gt; nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Acc lt n</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>(n &lt;=? <span class="mi">0</span>) = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n - <span class="mi">1</span> &lt; n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chke"><span class="nb">apply</span> Nat.leb_gt <span class="kr">in</span> e.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>f'</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : nat, Acc lt n -&gt; nat</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Acc lt n</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt; n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n - <span class="mi">1</span> &lt; n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Nat.sub_lt; <span class="nb">auto with</span> *.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Defined</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp"><span class="c">(* Compute (f&#39; 10 (lt_wf 10)). doesn&#39;t evaluate to a nat if ended with Qed. *)</span></span></pre><p>Anyway, my problem persists for <tt class="docutils literal">Z</tt>.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chkf"><span class="kn">Fixpoint</span> <span class="nf">g&#39;</span> (<span class="nv">n</span> : Z) (<span class="nv">H</span> : Acc (Zwf <span class="mi">0</span>) n) : Z.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g'</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : Z, Acc (Zwf <span class="mi">0</span>) n -&gt; Z</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Acc (Zwf <span class="mi">0</span>) n</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Z</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk10" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk10"><span class="nb">refine</span> (<span class="kr">if</span> dec (n &lt;=? <span class="mi">0</span>) <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> n + (g&#39; (n - <span class="mi">1</span>) (Acc_inv H _))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>g'</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">n</span> : Z, Acc (Zwf <span class="mi">0</span>) n -&gt; Z</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Acc (Zwf <span class="mi">0</span>) n</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>(n &lt;=? <span class="mi">0</span>) = false</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Zwf <span class="mi">0</span> (n - <span class="mi">1</span>) n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">split</span>; <span class="bp">now</span> <span class="nb">apply</span> Z.leb_gt <span class="kr">in</span> e; <span class="nb">auto with</span> *.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Defined</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk11"><span class="kn">Compute</span> (g&#39; <span class="mi">10</span> (Zwf_well_founded <span class="mi">0</span> <span class="mi">10</span>)).</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">= (<span class="kr">fix</span> Ffix
     (x : Z)
     (x0 : Acc
             (<span class="kr">fun</span> <span class="nv">x0</span> <span class="nv">x1</span> : Z =&gt;
              (<span class="kr">match</span> x1 <span class="kr">with</span>
               | <span class="mi">0</span> =&gt; Eq
               | Z.pos _ =&gt; Lt
               | Z.neg _ =&gt; Gt
               <span class="kr">end</span> = Gt -&gt; <span class="kt">False</span>) /\
              <span class="kr">match</span> x0 <span class="kr">with</span>
              | <span class="mi">0</span> =&gt;
                  <span class="kr">match</span> x1 <span class="kr">with</span>
                  | <span class="mi">0</span> =&gt; Eq
                  | Z.pos _ =&gt; Lt
                  | Z.neg _ =&gt; Gt
                  <span class="kr">end</span>
              | Z.pos x2 =&gt;
                  <span class="kr">match</span> x1 <span class="kr">with</span>
                  | Z.pos x3 =&gt;
                      (<span class="kr">fix</span> Ffix0
                         (x4 : comparison)
                         (x5 x6 : positive)
                         {<span class="kr">struct</span> x6} :
                           comparison :=
                         <span class="kr">match</span> x5 <span class="kr">with</span>
                         | (x7~<span class="mi">1</span>)%positive =&gt;
                             <span class="kr">match</span> x6 <span class="kr">with</span>
                             | (x8~<span class="mi">1</span>)%positive =&gt;
                                 Ffix0 x4 x7 x8
                             | (x8~<span class="mi">0</span>)%positive =&gt;
                                 Ffix0 Gt x7 x8
                             | <span class="mi">1</span>%positive =&gt; Gt
                             <span class="kr">end</span>
                         | (x7~<span class="mi">0</span>)%positive =&gt;
                             <span class="kr">match</span> x6 <span class="kr">with</span>
                             | (x8~<span class="mi">1</span>)%positive =&gt;
                                 Ffix0 Lt x7 x8
                             | (x8~<span class="mi">0</span>)%positive =&gt;
                                 Ffix0 x4 x7 x8
                             | <span class="mi">1</span>%positive =&gt; Gt
                             <span class="kr">end</span>
                         | <span class="mi">1</span>%positive =&gt;
                             <span class="kr">match</span> x6 <span class="kr">with</span>
                             | <span class="mi">1</span>%positive =&gt; x4
                             | _ =&gt; Lt
                             <span class="kr">end</span>
                         <span class="kr">end</span>) Eq x2 x3
                  | _ =&gt; Gt
                  <span class="kr">end</span>
              | Z.neg x2 =&gt;
                  <span class="kr">match</span> x1 <span class="kr">with</span>
                  | Z.neg x3 =&gt;
                      <span class="kr">match</span>
                        (<span class="kr">fix</span> Ffix0
                           (x4 : comparison)
                           (x5 x6 : positive)
                           {<span class="kr">struct</span> x6} :
                             comparison :=
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> ... <span class="kr">with</span>
                               | ... =&gt;
                                   Ffix0 x4 x7 x8
                               | ... =&gt;
                                   Ffix0 Gt x7 x8
                               | ... =&gt; Gt
                               <span class="kr">end</span>
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> ... <span class="kr">with</span>
                               | ... =&gt;
                                   Ffix0 Lt x7 x8
                               | ... =&gt;
                                   Ffix0 x4 x7 x8
                               | ... =&gt; Gt
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> ... <span class="kr">with</span>
                               | ... =&gt; x4
                               | ... =&gt; Lt
                               <span class="kr">end</span>
                           <span class="kr">end</span>) Eq x2 x3
                      <span class="kr">with</span>
                      | Eq =&gt; Eq
                      | Lt =&gt; Gt
                      | Gt =&gt; Lt
                      <span class="kr">end</span>
                  | _ =&gt; Lt
                  <span class="kr">end</span>
              <span class="kr">end</span> = Lt) x) {<span class="kr">struct</span> x0} : Z :=
     <span class="kr">match</span>
       (<span class="kr">if</span>
         <span class="kr">match</span>
           <span class="kr">match</span> x <span class="kr">with</span>
           | <span class="mi">0</span> =&gt; Eq
           | Z.pos _ =&gt; Gt
           | Z.neg _ =&gt; Lt
           <span class="kr">end</span>
         <span class="kr">with</span>
         | Gt =&gt; false
         | _ =&gt; true
         <span class="kr">end</span> <span class="kr">as</span> c
         <span class="kr">return</span> ({c = true} + {c = false})
        <span class="kr">then</span> in_left
        <span class="kr">else</span> in_right)
     <span class="kr">with</span>
     | in_left =&gt; <span class="mi">0</span>
     | <span class="nb">right</span> x1 =&gt;
         <span class="kr">match</span> x <span class="kr">with</span>
         | <span class="mi">0</span> =&gt;
             Ffix
               <span class="kr">match</span> x <span class="kr">with</span>
               | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
               | Z.pos x3~<span class="mi">1</span> =&gt; Z.pos x3~<span class="mi">0</span>
               | Z.pos x3~<span class="mi">0</span> =&gt;
                   Z.pos
                     ((<span class="kr">fix</span> Ffix0
                         (x4 : positive) :
                           positive :=
                         <span class="kr">match</span> x4 <span class="kr">with</span>
                         | (x5~<span class="mi">1</span>)%positive =&gt;
                             (x5~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                         | (x5~<span class="mi">0</span>)%positive =&gt;
                             ((Ffix0 x5)~<span class="mi">1</span>)%positive
                         | <span class="mi">1</span>%positive =&gt;
                             <span class="mi">1</span>%positive
                         <span class="kr">end</span>) x3)
               | <span class="mi">1</span> =&gt; <span class="mi">0</span>
               | Z.neg x2 =&gt;
                   Z.neg
                     ((<span class="kr">with</span> Ffix0
                         (x3 x4 : positive)
                         {<span class="kr">struct</span> x3} :
                           positive :=
                         <span class="kr">match</span> x3 <span class="kr">with</span>
                         | (x5~<span class="mi">1</span>)%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x6~<span class="mi">1</span>)%positive =&gt;
                                 ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                             | (x6~<span class="mi">0</span>)%positive =&gt;
                                 ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                             <span class="kr">end</span>
                         | (x5~<span class="mi">0</span>)%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x6~<span class="mi">1</span>)%positive =&gt;
                                 ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                             | (x6~<span class="mi">0</span>)%positive =&gt;
                                 ((Ffix0 x5 x6)~<span class="mi">0</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 (x5~<span class="mi">1</span>)%positive
                             <span class="kr">end</span>
                         | <span class="mi">1</span>%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x5~<span class="mi">1</span>)%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                             | (x5~<span class="mi">0</span>)%positive =&gt;
                                 (x5~<span class="mi">1</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 <span class="mi">2</span>%positive
                             <span class="kr">end</span>
                         <span class="kr">end</span>
                       <span class="kr">with</span> Ffix1
                         (x3 x4 : positive)
                         {<span class="kr">struct</span> x3} :
                           positive :=
                         <span class="kr">match</span> x3 <span class="kr">with</span>
                         | (x5~<span class="mi">1</span>)%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x6~<span class="mi">1</span>)%positive =&gt;
                                 ((Ffix1 x5 x6)~<span class="mi">1</span>)%positive
                             | (x6~<span class="mi">0</span>)%positive =&gt;
                                 ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">1</span>)%positive
                             <span class="kr">end</span>
                         | (x5~<span class="mi">0</span>)%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x6~<span class="mi">1</span>)%positive =&gt;
                                 ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                             | (x6~<span class="mi">0</span>)%positive =&gt;
                                 ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                             <span class="kr">end</span>
                         | <span class="mi">1</span>%positive =&gt;
                             <span class="kr">match</span> x4 <span class="kr">with</span>
                             | (x5~<span class="mi">1</span>)%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">1</span>)%positive
                             | (x5~<span class="mi">0</span>)%positive =&gt;
                                 (((<span class="kr">fix</span> Ffix2
                                      (x6 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        ...
                                      <span class="kr">with</span>
                                      | ... =&gt;
                                          (...)~<span class="mi">0</span>
                                      | ... =&gt;
                                          x7~<span class="mi">1</span>
                                      | ... =&gt; <span class="mi">2</span>
                                      <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                             | <span class="mi">1</span>%positive =&gt;
                                 <span class="mi">3</span>%positive
                             <span class="kr">end</span>
                         <span class="kr">end</span>
                       <span class="kr">for</span>
                       Ffix0) x2 <span class="mi">1</span>%positive)
               <span class="kr">end</span>
               (<span class="kr">match</span> x0 <span class="kr">with</span>
                | Acc_intro _ x2 =&gt; x2
                <span class="kr">end</span>
                  <span class="kr">match</span> x <span class="kr">with</span>
                  | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                  | Z.pos x3~<span class="mi">1</span> =&gt; Z.pos x3~<span class="mi">0</span>
                  | Z.pos x3~<span class="mi">0</span> =&gt;
                      Z.pos
                        ((<span class="kr">fix</span> Ffix0
                            (x4 : positive) :
                              positive :=
                            <span class="kr">match</span> x4 <span class="kr">with</span>
                            | (x5~<span class="mi">1</span>)%positive =&gt;
                                (x5~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                            | (x5~<span class="mi">0</span>)%positive =&gt;
                                ((Ffix0 x5)~<span class="mi">1</span>)%positive
                            | <span class="mi">1</span>%positive =&gt;
                                <span class="mi">1</span>%positive
                            <span class="kr">end</span>) x3)
                  | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                  | Z.neg x2 =&gt;
                      Z.neg
                        ((<span class="kr">with</span> Ffix0
                            (x3 x4 : positive)
                            {<span class="kr">struct</span> x3} :
                              positive :=
                            <span class="kr">match</span> x3 <span class="kr">with</span>
                            | (x5~<span class="mi">1</span>)%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x6~<span class="mi">1</span>)%positive =&gt;
                                    ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                                | (x6~<span class="mi">0</span>)%positive =&gt;
                                    ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                                <span class="kr">end</span>
                            | (x5~<span class="mi">0</span>)%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x6~<span class="mi">1</span>)%positive =&gt;
                                    ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                                | (x6~<span class="mi">0</span>)%positive =&gt;
                                    ((Ffix0 x5 x6)~<span class="mi">0</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    (x5~<span class="mi">1</span>)%positive
                                <span class="kr">end</span>
                            | <span class="mi">1</span>%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x5~<span class="mi">1</span>)%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                                | (x5~<span class="mi">0</span>)%positive =&gt;
                                    (x5~<span class="mi">1</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    <span class="mi">2</span>%positive
                                <span class="kr">end</span>
                            <span class="kr">end</span>
                          <span class="kr">with</span> Ffix1
                            (x3 x4 : positive)
                            {<span class="kr">struct</span> x3} :
                              positive :=
                            <span class="kr">match</span> x3 <span class="kr">with</span>
                            | (x5~<span class="mi">1</span>)%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x6~<span class="mi">1</span>)%positive =&gt;
                                    ((Ffix1 x5 x6)~<span class="mi">1</span>)%positive
                                | (x6~<span class="mi">0</span>)%positive =&gt;
                                    ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">1</span>)%positive
                                <span class="kr">end</span>
                            | (x5~<span class="mi">0</span>)%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x6~<span class="mi">1</span>)%positive =&gt;
                                    ((Ffix1 x5 x6)~<span class="mi">0</span>)%positive
                                | (x6~<span class="mi">0</span>)%positive =&gt;
                                    ((Ffix0 x5 x6)~<span class="mi">1</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                                <span class="kr">end</span>
                            | <span class="mi">1</span>%positive =&gt;
                                <span class="kr">match</span> x4 <span class="kr">with</span>
                                | (x5~<span class="mi">1</span>)%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">1</span>)%positive
                                | (x5~<span class="mi">0</span>)%positive =&gt;
                                    (((<span class="kr">fix</span> Ffix2
                                         ... :
                                           positive :=
                                         ...
                                         ...
                                         ...
                                         ...
                                         <span class="kr">end</span>) x5)~<span class="mi">0</span>)%positive
                                | <span class="mi">1</span>%positive =&gt;
                                    <span class="mi">3</span>%positive
                                <span class="kr">end</span>
                            <span class="kr">end</span>
                          <span class="kr">for</span>
                          Ffix0) x2 <span class="mi">1</span>%positive)
                  <span class="kr">end</span>
                  (conj
                     (g&#39;_subproof x
                        (<span class="kr">match</span> Z.leb_gt x <span class="mi">0</span> <span class="kr">with</span>
                         | conj x2 _ =&gt; x2
                         <span class="kr">end</span> x1))
                     (g&#39;_subproof0 x)))
         | Z.pos x2 =&gt;
             <span class="kr">match</span>
               Ffix
                 <span class="kr">match</span> x <span class="kr">with</span>
                 | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                 | Z.pos x4~<span class="mi">1</span> =&gt; Z.pos x4~<span class="mi">0</span>
                 | Z.pos x4~<span class="mi">0</span> =&gt;
                     Z.pos
                       ((<span class="kr">fix</span> Ffix0
                           (x5 : positive) :
                             positive :=
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (x6~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">1</span>%positive
                           <span class="kr">end</span>) x4)
                 | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                 | Z.neg x3 =&gt;
                     Z.neg
                       ((<span class="kr">with</span> Ffix0
                           (x4 x5 : positive)
                           {<span class="kr">struct</span> x4} :
                             positive :=
                           <span class="kr">match</span> x4 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               <span class="kr">end</span>
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (x6~<span class="mi">1</span>)%positive
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x6~<span class="mi">1</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               | (x6~<span class="mi">0</span>)%positive =&gt;
                                   (x6~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   <span class="mi">2</span>%positive
                               <span class="kr">end</span>
                           <span class="kr">end</span>
                         <span class="kr">with</span> Ffix1
                           (x4 x5 : positive)
                           {<span class="kr">struct</span> x4} :
                             positive :=
                           <span class="kr">match</span> x4 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">1</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">1</span>)%positive
                               <span class="kr">end</span>
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x6~<span class="mi">1</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">1</span>)%positive
                               | (x6~<span class="mi">0</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   <span class="mi">3</span>%positive
                               <span class="kr">end</span>
                           <span class="kr">end</span>
                         <span class="kr">for</span>
                         Ffix0) x3 <span class="mi">1</span>%positive)
                 <span class="kr">end</span>
                 (<span class="kr">match</span> x0 <span class="kr">with</span>
                  | Acc_intro _ x3 =&gt; x3
                  <span class="kr">end</span>
                    <span class="kr">match</span> x <span class="kr">with</span>
                    | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                    | Z.pos x4~<span class="mi">1</span> =&gt; Z.pos x4~<span class="mi">0</span>
                    | Z.pos x4~<span class="mi">0</span> =&gt;
                        Z.pos
                          ((<span class="kr">fix</span> Ffix0
                              (x5 : positive) :
                                positive :=
                              <span class="kr">match</span> x5 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  (x6~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  ((Ffix0 x6)~<span class="mi">1</span>)%positive
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="mi">1</span>%positive
                              <span class="kr">end</span>) x4)
                    | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                    | Z.neg x3 =&gt;
                        Z.neg
                          ((<span class="kr">with</span> Ffix0
                              (x4 x5 : positive)
                              {<span class="kr">struct</span> x4} :
                                positive :=
                              <span class="kr">match</span> x4 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  <span class="kr">end</span>
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      (x6~<span class="mi">1</span>)%positive
                                  <span class="kr">end</span>
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      (x6~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">2</span>%positive
                                  <span class="kr">end</span>
                              <span class="kr">end</span>
                            <span class="kr">with</span> Ffix1
                              (x4 x5 : positive)
                              {<span class="kr">struct</span> x4} :
                                positive :=
                              <span class="kr">match</span> x4 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  <span class="kr">end</span>
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  <span class="kr">end</span>
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">3</span>%positive
                                  <span class="kr">end</span>
                              <span class="kr">end</span>
                            <span class="kr">for</span>
                            Ffix0) x3 <span class="mi">1</span>%positive)
                    <span class="kr">end</span>
                    (conj
                       (g&#39;_subproof x
                          (<span class="kr">match</span>
                             Z.leb_gt x <span class="mi">0</span>
                           <span class="kr">with</span>
                           | conj x3 _ =&gt; x3
                           <span class="kr">end</span> x1))
                       (g&#39;_subproof0 x)))
             <span class="kr">with</span>
             | <span class="mi">0</span> =&gt; x
             | Z.pos x3 =&gt;
                 Z.pos
                   ((<span class="kr">with</span> Ffix0
                       (x4 x5 : positive) {<span class="kr">struct</span>
                        x4} : positive :=
                       <span class="kr">match</span> x4 <span class="kr">with</span>
                       | (x6~<span class="mi">1</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           <span class="kr">end</span>
                       | (x6~<span class="mi">0</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (x6~<span class="mi">1</span>)%positive
                           <span class="kr">end</span>
                       | <span class="mi">1</span>%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               (x6~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">2</span>%positive
                           <span class="kr">end</span>
                       <span class="kr">end</span>
                     <span class="kr">with</span> Ffix1
                       (x4 x5 : positive) {<span class="kr">struct</span>
                        x4} : positive :=
                       <span class="kr">match</span> x4 <span class="kr">with</span>
                       | (x6~<span class="mi">1</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">1</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">1</span>)%positive
                           <span class="kr">end</span>
                       | (x6~<span class="mi">0</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           <span class="kr">end</span>
                       | <span class="mi">1</span>%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">1</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">3</span>%positive
                           <span class="kr">end</span>
                       <span class="kr">end</span>
                     <span class="kr">for</span>
                     Ffix0) x2 x3)
             | Z.neg x3 =&gt;
                 (<span class="kr">fix</span> Ffix0
                    (x4 x5 : positive) {<span class="kr">struct</span>
                     x5} : Z :=
                    <span class="kr">match</span> x4 <span class="kr">with</span>
                    | (x6~<span class="mi">1</span>)%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x7~<span class="mi">1</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">0</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">0</span>
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">0</span>
                            <span class="kr">end</span>
                        | (x7~<span class="mi">0</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">1</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">1</span>
                            | Z.neg x8 =&gt;
                                Z.neg
                                  ((<span class="kr">fix</span> Ffix1
                                      (x9 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        x9
                                      <span class="kr">with</span>
                                      | ...%positive =&gt;
                                          (x10~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                      | ...%positive =&gt;
                                          ((...)~<span class="mi">1</span>)%positive
                                      | <span class="mi">1</span>%positive =&gt;
                                          <span class="mi">1</span>%positive
                                      <span class="kr">end</span>) x8)
                            <span class="kr">end</span>
                        | <span class="mi">1</span>%positive =&gt;
                            Z.pos x6~<span class="mi">0</span>
                        <span class="kr">end</span>
                    | (x6~<span class="mi">0</span>)%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x7~<span class="mi">1</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                            | Z.pos x8 =&gt;
                                Z.pos
                                  ((<span class="kr">fix</span> Ffix1
                                      (x9 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        x9
                                      <span class="kr">with</span>
                                      | ...%positive =&gt;
                                          (x10~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                      | ...%positive =&gt;
                                          ((...)~<span class="mi">1</span>)%positive
                                      | <span class="mi">1</span>%positive =&gt;
                                          <span class="mi">1</span>%positive
                                      <span class="kr">end</span>) x8)
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">1</span>
                            <span class="kr">end</span>
                        | (x7~<span class="mi">0</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">0</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">0</span>
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">0</span>
                            <span class="kr">end</span>
                        | <span class="mi">1</span>%positive =&gt;
                            Z.pos
                              ((<span class="kr">fix</span> Ffix1
                                  (x7 : positive) :
                                    positive :=
                                  <span class="kr">match</span> x7 <span class="kr">with</span>
                                  | (x8~<span class="mi">1</span>)%positive =&gt;
                                      (x8~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                  | (x8~<span class="mi">0</span>)%positive =&gt;
                                      ((Ffix1 x8)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">1</span>%positive
                                  <span class="kr">end</span>) x6)
                        <span class="kr">end</span>
                    | <span class="mi">1</span>%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x6~<span class="mi">1</span>)%positive =&gt;
                            Z.neg x6~<span class="mi">0</span>
                        | (x6~<span class="mi">0</span>)%positive =&gt;
                            Z.neg
                              ((<span class="kr">fix</span> Ffix1
                                  (x7 : positive) :
                                    positive :=
                                  <span class="kr">match</span> x7 <span class="kr">with</span>
                                  | (x8~<span class="mi">1</span>)%positive =&gt;
                                      (x8~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                  | (x8~<span class="mi">0</span>)%positive =&gt;
                                      ((Ffix1 x8)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">1</span>%positive
                                  <span class="kr">end</span>) x6)
                        | <span class="mi">1</span>%positive =&gt; <span class="mi">0</span>
                        <span class="kr">end</span>
                    <span class="kr">end</span>) x2 x3
             <span class="kr">end</span>
         | Z.neg x2 =&gt;
             <span class="kr">match</span>
               Ffix
                 <span class="kr">match</span> x <span class="kr">with</span>
                 | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                 | Z.pos x4~<span class="mi">1</span> =&gt; Z.pos x4~<span class="mi">0</span>
                 | Z.pos x4~<span class="mi">0</span> =&gt;
                     Z.pos
                       ((<span class="kr">fix</span> Ffix0
                           (x5 : positive) :
                             positive :=
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (x6~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">1</span>%positive
                           <span class="kr">end</span>) x4)
                 | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                 | Z.neg x3 =&gt;
                     Z.neg
                       ((<span class="kr">with</span> Ffix0
                           (x4 x5 : positive)
                           {<span class="kr">struct</span> x4} :
                             positive :=
                           <span class="kr">match</span> x4 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               <span class="kr">end</span>
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (x6~<span class="mi">1</span>)%positive
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x6~<span class="mi">1</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               | (x6~<span class="mi">0</span>)%positive =&gt;
                                   (x6~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   <span class="mi">2</span>%positive
                               <span class="kr">end</span>
                           <span class="kr">end</span>
                         <span class="kr">with</span> Ffix1
                           (x4 x5 : positive)
                           {<span class="kr">struct</span> x4} :
                             positive :=
                           <span class="kr">match</span> x4 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">1</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">1</span>)%positive
                               <span class="kr">end</span>
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x7~<span class="mi">1</span>)%positive =&gt;
                                   ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                               | (x7~<span class="mi">0</span>)%positive =&gt;
                                   ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               <span class="kr">end</span>
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="kr">match</span> x5 <span class="kr">with</span>
                               | (x6~<span class="mi">1</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">1</span>)%positive
                               | (x6~<span class="mi">0</span>)%positive =&gt;
                                   (((...) x6)~<span class="mi">0</span>)%positive
                               | <span class="mi">1</span>%positive =&gt;
                                   <span class="mi">3</span>%positive
                               <span class="kr">end</span>
                           <span class="kr">end</span>
                         <span class="kr">for</span>
                         Ffix0) x3 <span class="mi">1</span>%positive)
                 <span class="kr">end</span>
                 (<span class="kr">match</span> x0 <span class="kr">with</span>
                  | Acc_intro _ x3 =&gt; x3
                  <span class="kr">end</span>
                    <span class="kr">match</span> x <span class="kr">with</span>
                    | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                    | Z.pos x4~<span class="mi">1</span> =&gt; Z.pos x4~<span class="mi">0</span>
                    | Z.pos x4~<span class="mi">0</span> =&gt;
                        Z.pos
                          ((<span class="kr">fix</span> Ffix0
                              (x5 : positive) :
                                positive :=
                              <span class="kr">match</span> x5 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  (x6~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  ((Ffix0 x6)~<span class="mi">1</span>)%positive
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="mi">1</span>%positive
                              <span class="kr">end</span>) x4)
                    | <span class="mi">1</span> =&gt; <span class="mi">0</span>
                    | Z.neg x3 =&gt;
                        Z.neg
                          ((<span class="kr">with</span> Ffix0
                              (x4 x5 : positive)
                              {<span class="kr">struct</span> x4} :
                                positive :=
                              <span class="kr">match</span> x4 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  <span class="kr">end</span>
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      (x6~<span class="mi">1</span>)%positive
                                  <span class="kr">end</span>
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      (x6~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">2</span>%positive
                                  <span class="kr">end</span>
                              <span class="kr">end</span>
                            <span class="kr">with</span> Ffix1
                              (x4 x5 : positive)
                              {<span class="kr">struct</span> x4} :
                                positive :=
                              <span class="kr">match</span> x4 <span class="kr">with</span>
                              | (x6~<span class="mi">1</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  <span class="kr">end</span>
                              | (x6~<span class="mi">0</span>)%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  <span class="kr">end</span>
                              | <span class="mi">1</span>%positive =&gt;
                                  <span class="kr">match</span> x5 <span class="kr">with</span>
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">1</span>)%positive
                                  | ...%positive =&gt;
                                      ((...)~<span class="mi">0</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">3</span>%positive
                                  <span class="kr">end</span>
                              <span class="kr">end</span>
                            <span class="kr">for</span>
                            Ffix0) x3 <span class="mi">1</span>%positive)
                    <span class="kr">end</span>
                    (conj
                       (g&#39;_subproof x
                          (<span class="kr">match</span>
                             Z.leb_gt x <span class="mi">0</span>
                           <span class="kr">with</span>
                           | conj x3 _ =&gt; x3
                           <span class="kr">end</span> x1))
                       (g&#39;_subproof0 x)))
             <span class="kr">with</span>
             | <span class="mi">0</span> =&gt; x
             | Z.pos x3 =&gt;
                 (<span class="kr">fix</span> Ffix0
                    (x4 x5 : positive) {<span class="kr">struct</span>
                     x5} : Z :=
                    <span class="kr">match</span> x4 <span class="kr">with</span>
                    | (x6~<span class="mi">1</span>)%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x7~<span class="mi">1</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">0</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">0</span>
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">0</span>
                            <span class="kr">end</span>
                        | (x7~<span class="mi">0</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">1</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">1</span>
                            | Z.neg x8 =&gt;
                                Z.neg
                                  ((<span class="kr">fix</span> Ffix1
                                      (x9 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        x9
                                      <span class="kr">with</span>
                                      | ...%positive =&gt;
                                          (x10~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                      | ...%positive =&gt;
                                          ((...)~<span class="mi">1</span>)%positive
                                      | <span class="mi">1</span>%positive =&gt;
                                          <span class="mi">1</span>%positive
                                      <span class="kr">end</span>) x8)
                            <span class="kr">end</span>
                        | <span class="mi">1</span>%positive =&gt;
                            Z.pos x6~<span class="mi">0</span>
                        <span class="kr">end</span>
                    | (x6~<span class="mi">0</span>)%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x7~<span class="mi">1</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; -<span class="mi">1</span>
                            | Z.pos x8 =&gt;
                                Z.pos
                                  ((<span class="kr">fix</span> Ffix1
                                      (x9 : positive) :
                                        positive :=
                                      <span class="kr">match</span>
                                        x9
                                      <span class="kr">with</span>
                                      | ...%positive =&gt;
                                          (x10~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                      | ...%positive =&gt;
                                          ((...)~<span class="mi">1</span>)%positive
                                      | <span class="mi">1</span>%positive =&gt;
                                          <span class="mi">1</span>%positive
                                      <span class="kr">end</span>) x8)
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">1</span>
                            <span class="kr">end</span>
                        | (x7~<span class="mi">0</span>)%positive =&gt;
                            <span class="kr">match</span>
                              Ffix0 x6 x7
                            <span class="kr">with</span>
                            | <span class="mi">0</span> =&gt; <span class="mi">0</span>
                            | Z.pos x8 =&gt;
                                Z.pos x8~<span class="mi">0</span>
                            | Z.neg x8 =&gt;
                                Z.neg x8~<span class="mi">0</span>
                            <span class="kr">end</span>
                        | <span class="mi">1</span>%positive =&gt;
                            Z.pos
                              ((<span class="kr">fix</span> Ffix1
                                  (x7 : positive) :
                                    positive :=
                                  <span class="kr">match</span> x7 <span class="kr">with</span>
                                  | (x8~<span class="mi">1</span>)%positive =&gt;
                                      (x8~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                  | (x8~<span class="mi">0</span>)%positive =&gt;
                                      ((Ffix1 x8)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">1</span>%positive
                                  <span class="kr">end</span>) x6)
                        <span class="kr">end</span>
                    | <span class="mi">1</span>%positive =&gt;
                        <span class="kr">match</span> x5 <span class="kr">with</span>
                        | (x6~<span class="mi">1</span>)%positive =&gt;
                            Z.neg x6~<span class="mi">0</span>
                        | (x6~<span class="mi">0</span>)%positive =&gt;
                            Z.neg
                              ((<span class="kr">fix</span> Ffix1
                                  (x7 : positive) :
                                    positive :=
                                  <span class="kr">match</span> x7 <span class="kr">with</span>
                                  | (x8~<span class="mi">1</span>)%positive =&gt;
                                      (x8~<span class="mi">0</span>~<span class="mi">1</span>)%positive
                                  | (x8~<span class="mi">0</span>)%positive =&gt;
                                      ((Ffix1 x8)~<span class="mi">1</span>)%positive
                                  | <span class="mi">1</span>%positive =&gt;
                                      <span class="mi">1</span>%positive
                                  <span class="kr">end</span>) x6)
                        | <span class="mi">1</span>%positive =&gt; <span class="mi">0</span>
                        <span class="kr">end</span>
                    <span class="kr">end</span>) x3 x2
             | Z.neg x3 =&gt;
                 Z.neg
                   ((<span class="kr">with</span> Ffix0
                       (x4 x5 : positive) {<span class="kr">struct</span>
                        x4} : positive :=
                       <span class="kr">match</span> x4 <span class="kr">with</span>
                       | (x6~<span class="mi">1</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           <span class="kr">end</span>
                       | (x6~<span class="mi">0</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (x6~<span class="mi">1</span>)%positive
                           <span class="kr">end</span>
                       | <span class="mi">1</span>%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               (x6~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">2</span>%positive
                           <span class="kr">end</span>
                       <span class="kr">end</span>
                     <span class="kr">with</span> Ffix1
                       (x4 x5 : positive) {<span class="kr">struct</span>
                        x4} : positive :=
                       <span class="kr">match</span> x4 <span class="kr">with</span>
                       | (x6~<span class="mi">1</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">1</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">1</span>)%positive
                           <span class="kr">end</span>
                       | (x6~<span class="mi">0</span>)%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x7~<span class="mi">1</span>)%positive =&gt;
                               ((Ffix1 x6 x7)~<span class="mi">0</span>)%positive
                           | (x7~<span class="mi">0</span>)%positive =&gt;
                               ((Ffix0 x6 x7)~<span class="mi">1</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           <span class="kr">end</span>
                       | <span class="mi">1</span>%positive =&gt;
                           <span class="kr">match</span> x5 <span class="kr">with</span>
                           | (x6~<span class="mi">1</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">1</span>)%positive
                           | (x6~<span class="mi">0</span>)%positive =&gt;
                               (((<span class="kr">fix</span> Ffix2
                                    (x7 : positive) :
                                      positive :=
                                    <span class="kr">match</span> x7 <span class="kr">with</span>
                                    | x8~<span class="mi">1</span> =&gt;
                                        (Ffix2 x8)~<span class="mi">0</span>
                                    | x8~<span class="mi">0</span> =&gt;
                                        x8~<span class="mi">1</span>
                                    | <span class="mi">1</span> =&gt; <span class="mi">2</span>
                                    <span class="kr">end</span>) x6)~<span class="mi">0</span>)%positive
                           | <span class="mi">1</span>%positive =&gt;
                               <span class="mi">3</span>%positive
                           <span class="kr">end</span>
                       <span class="kr">end</span>
                     <span class="kr">for</span>
                     Ffix0) x2 x3)
             <span class="kr">end</span>
         <span class="kr">end</span>
     <span class="kr">end</span>) <span class="mi">10</span> (Zwf_well_founded <span class="mi">0</span> <span class="mi">10</span>)
: Z</blockquote></div></div></small></span></pre><hr class="docutils" />
<p><strong>A:</strong> This is a related <a class="reference external" href="https://stackoverflow.com/questions/32354286/compute-with-a-recursive-function-defined-by-well-defined-induction">question</a>.</p>
<p><strong>A:</strong> This <a class="reference external" href="https://stackoverflow.com/questions/28478445/">one</a> is
somewhat related as well.</p>
</div>
<div class="section" id="answer">
<h1>Answer</h1>
<p>Making <a class="reference external" href="https://coq.inria.fr/library/Coq.ZArith.Zwf.html#Zwf_well_founded">Zwf_well_founded</a>
transparent won't help, because of the way it is defined in the
standard library:</p>
<pre class="code coq literal-block">
<span class="kn">Lemma</span> <span class="nf">Zwf_well_founded</span> <span class="o">:</span> <span class="n">well_founded</span> <span class="o">(</span><span class="n">Zwf</span> <span class="n">c</span><span class="o">).</span>
  <span class="o">...</span>
  <span class="nb">case</span> <span class="o">(</span><span class="n">Z</span><span class="o">.</span><span class="n">le_gt_cases</span> <span class="n">c</span> <span class="n">y</span><span class="o">);</span> <span class="nb">intro</span><span class="o">;</span> <span class="nb">auto with</span> <span class="n">zarith</span><span class="o">.</span>
  <span class="o">...</span>
<span class="kn">Qed</span><span class="o">.</span>
</pre>
<p>If you replace the line in the proof above with</p>
<pre class="code coq literal-block">
<span class="nb">case</span> <span class="o">(</span><span class="n">Z_le_gt_dec</span> <span class="n">c</span> <span class="n">y</span><span class="o">);</span> <span class="nb">intro</span><span class="o">;</span> <span class="nb">auto with</span> <span class="n">zarith</span><span class="o">.</span>
</pre>
<p>and replace <tt class="docutils literal">Qed.</tt> with <tt class="docutils literal">Defined.</tt> (which you already did)
everything should work. This is due the fact that the original proof
depends on a logical term, and that prevents the evaluator from doing
pattern-matching, because logical entity <tt class="docutils literal">Z.le_gt_cases</tt> is opaque,
while computational entity <tt class="docutils literal">Z_le_gt_dec</tt> is transparent. See <a class="reference external" href="http://gallium.inria.fr/blog/coq-eval/">Using
Coq's evaluation mechanisms in anger</a> blog post by Xavier Leroy.
You might also find useful <a class="reference external" href="https://gmalecha.github.io/reflections/2017/qed-considered-harmful">Qed Considered Harmful</a>
post by Gregory Malecha.</p>
<p>Instead of modifying the proof of <tt class="docutils literal">Zwf_well_founded</tt> you can reuse
<a class="reference external" href="https://coq.inria.fr/library/Coq.ZArith.Wf_Z.html#Zlt_0_rec">Zlt_0_rec</a> like
so:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Coq.ZArith.ZArith.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Open Scope</span> Z.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk12"><span class="kn">Definition</span> <span class="nf">H</span> (<span class="nv">x</span> : Z) (<span class="nv">H_rec</span> : (<span class="kr">forall</span> <span class="nv">y</span> : Z, <span class="mi">0</span> &lt;= y &lt; x -&gt; Z))
           (<span class="nv">nonneg</span> : <span class="mi">0</span> &lt;= x) : Z.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H_rec</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">y</span> : Z, <span class="mi">0</span> &lt;= y &lt; x -&gt; Z</span></span></span><br><span><var>nonneg</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= x</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Z</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk13"><span class="nb">refine</span> (<span class="kr">if</span> Z_zerop x <span class="kr">then</span> <span class="mi">0</span> <span class="kr">else</span> x + (H_rec (Z.pred x) _ )).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H_rec</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">y</span> : Z, <span class="mi">0</span> &lt;= y &lt; x -&gt; Z</span></span></span><br><span><var>nonneg</var><span class="hyp-type"><b>: </b><span><span class="mi">0</span> &lt;= x</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>x &lt;&gt; <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">0</span> &lt;= Z.pred x &lt; x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto with</span> zarith.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Defined</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">h</span> (<span class="nv">z</span> : Z) : Z :=
  <span class="kr">match</span> Z_lt_le_dec z <span class="mi">0</span> <span class="kr">with</span> <span class="nb">left</span> _ =&gt; <span class="mi">0</span> | <span class="nb">right</span> pf =&gt; (Zlt_0_rec _ H z pf) <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="coq-cant-compute-a-well-founded-function-on-z-but-it-works-on-nat-v-chk14"><span class="kn">Check</span> eq_refl : h <span class="mi">100</span> = <span class="mi">5050</span>.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">eq_refl : h <span class="mi">100</span> = <span class="mi">5050</span>
     : h <span class="mi">100</span> = <span class="mi">5050</span></blockquote></div></div></small></span></pre><p>It's a bit less convenient because now we have to deal with negative
numbers in <tt class="docutils literal">h</tt>.</p>
</div>
</div>
</div>
</div></body>
</html>
