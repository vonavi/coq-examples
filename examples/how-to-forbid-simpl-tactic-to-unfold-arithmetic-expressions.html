<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta charset="utf-8" />
<meta name="generator" content="Docutils 0.20.1: https://docutils.sourceforge.io/" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>How to forbid simpl tactic to unfold arithmetic expressions?</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><main id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions">
<h1 class="title">How to forbid <span class="docutils literal">simpl</span> tactic to unfold arithmetic expressions?</h1>
<dl class="docinfo simple">
<dt class="link">Link<span class="colon">:</span></dt>
<dd class="link"><p><a class="reference external" href="https://stackoverflow.com/q/28432187">https://stackoverflow.com/q/28432187</a></p>
</dd>
</dl>
<input type="checkbox" class="alectryon-toggle" id="alectryon-toggle-0" /><label for="alectryon-toggle-0" class="alectryon-toggle-label">Display all goals and responses</label><div class="alectryon-container docutils container">
<section id="question">
<h2>Question</h2>
<p>The <span class="docutils literal">simpl</span> tactic unfolds expressions like <span class="docutils literal">2 + a</span> to &quot;match
trees&quot; which doesn't seem simple at all. For example:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk0"><span class="kn">Goal</span> <span class="kr">forall</span> <span class="nv">i</span> : Z, (<span class="kr">fun</span> <span class="nv">x</span> =&gt; x + i) <span class="mi">3</span> = i + <span class="mi">3</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z, (<span class="kr">fun</span> <span class="nv">x</span> : Z =&gt; x + i) <span class="mi">3</span> = i + <span class="mi">3</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input checked="checked" class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk1"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z,
<span class="kr">match</span> i <span class="kr">with</span>
| <span class="mi">0</span> =&gt; <span class="mi">3</span>
| Z.pos y&#39; =&gt;
    Z.pos
      <span class="kr">match</span> y&#39; <span class="kr">with</span>
      | q~<span class="mi">1</span> =&gt;
          <span class="kr">match</span> q <span class="kr">with</span>
          | q0~<span class="mi">1</span> =&gt; (Pos.succ q0)~<span class="mi">1</span>
          | q0~<span class="mi">0</span> =&gt; (Pos.succ q0)~<span class="mi">0</span>
          | <span class="mi">1</span> =&gt; <span class="mi">3</span>
          <span class="kr">end</span>~<span class="mi">0</span>
      | q~<span class="mi">0</span> =&gt;
          <span class="kr">match</span> q <span class="kr">with</span>
          | q0~<span class="mi">1</span> =&gt; (Pos.succ q0)~<span class="mi">0</span>
          | q0~<span class="mi">0</span> =&gt; q0~<span class="mi">1</span>
          | <span class="mi">1</span> =&gt; <span class="mi">2</span>
          <span class="kr">end</span>~<span class="mi">1</span>
      | <span class="mi">1</span> =&gt; <span class="mi">4</span>
      <span class="kr">end</span>
| Z.neg y&#39; =&gt; Z.pos_sub <span class="mi">3</span> y&#39;
<span class="kr">end</span> = i + <span class="mi">3</span></div></blockquote></div></div></small></span></pre><p>How to avoid such complications with <span class="docutils literal">simpl</span> tactic?</p>
<p>This particular goal can be solved with <span class="docutils literal">omega</span>, but if it is a bit
more sophisticated, <span class="docutils literal">omega</span> fails, and I have to resort to something
like: <span class="docutils literal">replace (2 + a) with (a + 2). simpl; replace (a + 2) with (2 + a)</span>.</p>
</section>
<section id="answer-arthur-azevedo-de-amorim">
<h2>Answer (Arthur Azevedo De Amorim)</h2>
<p>You can control definition unfolding with the <span class="docutils literal">Transparent</span> and
<span class="docutils literal">Opaque</span> commands. In your example, you should be able to say
something like</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk2"><span class="kn">Opaque</span> Z.add.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z, (<span class="kr">fun</span> <span class="nv">x</span> : Z =&gt; x + i) <span class="mi">3</span> = i + <span class="mi">3</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk3"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z, <span class="mi">3</span> + i = i + <span class="mi">3</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk4"><span class="kn">Transparent</span> Z.add.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z, <span class="mi">3</span> + i = i + <span class="mi">3</span></div></blockquote></div></div></small></span></pre><p>Alternatively, the <span class="docutils literal">Arguments</span> <a class="reference external" href="https://coq.inria.fr/distrib/current/refman/Reference-Manual010.html#hevea_command232">command</a>
can be used to instruct the <span class="docutils literal">simpl</span> tactic to avoid simplifying
terms in certain contexts. E.g.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk5"><span class="kn">Arguments</span> Z.add _ _ : <span class="nb">simpl</span> nomatch.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z, (<span class="kr">fun</span> <span class="nv">x</span> : Z =&gt; x + i) <span class="mi">3</span> = i + <span class="mi">3</span></div></blockquote></div></div></small></span></pre><p>does the trick for me in your case. What this particular variant does
is to avoid simplifying a term when a big, ugly <span class="docutils literal">match</span> would appear
in head position after doing so (what you saw in your example). There
are other variants too, however.</p>
<p>Finally, just for completeness, the <a class="reference external" href="http://ssr.msr-inria.inria.fr/">Ssreflect</a> library provides nice
infrastructure for making certain definitions opaque locally. So you
could say something like</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk6"><span class="nb">rewrite</span> (lock Z.add) /= -lock.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z, <span class="mi">3</span> + i = i + <span class="mi">3</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span></pre><p>meaning &quot;lock <span class="docutils literal">Z.add</span>, so that it won't simplify, then simplify the
remaining of the expression (the <span class="docutils literal">/=</span> switch), then unlock the
definition again (<span class="docutils literal"><span class="pre">-lock</span></span>)&quot;.</p>
</section>
<section id="answer-pielemma">
<h2>Answer (pielemma)</h2>
<p>You can tweak how the simpl tactic behaves so you get less matches.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Coq.ZArith.ZArith.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk7"><span class="kn">Goal</span> <span class="kr">forall</span> <span class="nv">i</span> : Z, ((<span class="kr">fun</span> <span class="nv">x</span> =&gt; (x + i)%Z) <span class="mi">3</span>%Z = (i + <span class="mi">3</span>)%Z).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z, (<span class="kr">fun</span> <span class="nv">x</span> : Z =&gt; (x + i)%Z) <span class="mi">3</span>%Z = (i + <span class="mi">3</span>)%Z</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk8"><span class="kn">Arguments</span> Z.add x y : <span class="nb">simpl</span> nomatch.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z, (<span class="kr">fun</span> <span class="nv">x</span> : Z =&gt; (x + i)%Z) <span class="mi">3</span>%Z = (i + <span class="mi">3</span>)%Z</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-forbid-simpl-tactic-to-unfold-arithmetic-expressions-v-chk9"><span class="nb">simpl</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">i</span> : Z, (<span class="mi">3</span> + i)%Z = (i + <span class="mi">3</span>)%Z</div></blockquote></div></div></small></span></pre><p>Read more about it <a class="reference external" href="https://coq.inria.fr/distrib/current/refman/Reference-Manual010.html#hevea_tactic135">here</a>.</p>
<p>Otherwise you can use <a class="reference external" href="https://coq.inria.fr/distrib/current/refman/tactic-index.html">other tactics</a>
that allow you to choose how to reduce. <span class="docutils literal">cbn beta</span>, for example.</p>
</section>
</div>
</main>
</div></body>
</html>
