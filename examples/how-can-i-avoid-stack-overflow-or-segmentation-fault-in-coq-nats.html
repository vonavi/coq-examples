<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta charset="utf-8" />
<meta name="generator" content="Docutils 0.21.2: https://docutils.sourceforge.io/" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>How can I avoid stack overflow or segmentation fault in Coq nats?</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><main id="how-can-i-avoid-stack-overflow-or-segmentation-fault-in-coq-nats">
<h1 class="title">How can I avoid stack overflow or segmentation fault in Coq <span class="docutils literal">nat</span>s?</h1>
<dl class="docinfo simple">
<dt class="link">Link<span class="colon">:</span></dt>
<dd class="link"><p><a class="reference external" href="https://stackoverflow.com/q/13662274">https://stackoverflow.com/q/13662274</a></p>
</dd>
</dl>
<section id="question">
<h2>Question</h2>
<p>I'm currently working with <a class="reference external" href="http://www.cis.upenn.edu/~jianzhou/Vellvm/">vellvm</a>, developing a
transformation on it. I'm a Coq newbie.</p>
<p>While programming, I faced the following warning:</p>
<blockquote>
<p>Warning: Stack overflow or segmentation fault happens when working
with large numbers in nat (observed threshold may vary from 5000
to 70000 depending on your system limits and on the command
executed).</p>
</blockquote>
<p>My function that generates this warning calculates a signature. The
signature is divided in superior and inferior bits. Given two <span class="docutils literal">nat</span>s <span class="docutils literal">n1</span> and <span class="docutils literal">n2</span> representing the superior bits and the inferior
bits, it calculates <span class="docutils literal">(n1 * 65536) + n2</span> - this is an abstraction for
put two binary numbers of 16 bits side-by-side.</p>
<p>I was quite surprised because Coq <span class="docutils literal">nat</span> definition appears to handle
big ints from outside, thanks to the <span class="docutils literal">S</span> constructor.</p>
<p>How should I avoid this warning/use big numbers in Coq? I'm open to
change the implementation from <span class="docutils literal">nat</span> to some kind of binary
construction.</p>
</section>
<section id="answer">
<h2>Answer</h2>
<p>Instead of using the <span class="docutils literal">nat</span> type in Coq, it's sometimes (when you
have to manipulate big numbers) better to use the <a class="reference external" href="http://coq.inria.fr/distrib/8.4/stdlib/Coq.Numbers.BinNums.html#Z">Z</a>
type, which is a formalization of integers using a sign magnitude pair
representation. The tradeoff is that your proofs might get slightly
more complex; <span class="docutils literal">nat</span> is very simple, and so admits simple proof
principles.</p>
<p>However, in Coq there's an extensive use of notation to make it
simpler to write definitions, theorems, and proofs. Coq has an
extremely small kernel (we want this because we want to be able to
believe the proof checker is correct, and we can read that) with a lot
of notation on top of it. However, as there are different
representations of things, and only a few good symbols, our symbols
typically clash. To get past this, Coq uses <a class="reference external" href="http://coq.inria.fr/doc/Reference-Manual015.html">interpretation scopes</a> to disambiguate
symbols, and resolve them into names (because <span class="docutils literal">+</span> means <span class="docutils literal">add</span>,
<span class="docutils literal">plus</span>, etc...).</p>
<p>You are correct, using <span class="docutils literal">Z_scope</span> is where, <span class="docutils literal">+</span> for <span class="docutils literal">plus</span> within
<span class="docutils literal">Z</span>.</p>
</section>
</main>
</div></body>
</html>
