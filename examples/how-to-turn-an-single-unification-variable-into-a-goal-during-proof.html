<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta charset="utf-8" />
<meta name="generator" content="Docutils 0.21.2: https://docutils.sourceforge.io/" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>How to turn an single unification variable into a goal, during proof</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><main id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof">
<h1 class="title">How to turn an single unification variable into a goal, during proof</h1>
<dl class="docinfo simple">
<dt class="link">Link<span class="colon">:</span></dt>
<dd class="link"><p><a class="reference external" href="https://stackoverflow.com/q/53549618">https://stackoverflow.com/q/53549618</a></p>
</dd>
</dl>
<input type="checkbox" class="alectryon-toggle" id="alectryon-toggle-0" /><label for="alectryon-toggle-0" class="alectryon-toggle-label">Display all goals and responses</label><div class="alectryon-container docutils container">
<section id="question">
<h2>Question</h2>
<p>I want to construct an existential variable interactively. I can't use
<a class="reference external" href="https://coq.inria.fr/refman/proof-engine/proof-handling.html#coq:cmd.grab-existential-variables">Grab Existential Variables</a>
because I need to fill the existential before I complete the goal.</p>
<p><strong>Minimal example</strong> Here is a minimal example (since it's simple, it
has other solutions, but it illustrates my question)</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span> (<span class="nv">A</span>: <span class="kt">Type</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Parameter</span> <span class="nv">P</span> <span class="nv">Q</span>: A -&gt; <span class="kt">Prop</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">filter</span>: <span class="kr">forall</span> {<span class="nv">a</span>}, P a -&gt; A := <span class="kr">fun</span> <span class="nv">a</span> <span class="nv">Pa</span> =&gt; a.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk0"><span class="kn">Lemma</span> <span class="nf">my_lemma</span>:
  <span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span>, Q b -&gt; (Q b -&gt; P a) -&gt;
              <span class="kr">exists</span> <span class="nv">a</span> (<span class="nv">H</span>: P a), P (filter H).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : A,
Q b -&gt;
(Q b -&gt; P a) -&gt;
<span class="kr">exists</span> (<span class="nv">a0</span> : A) (<span class="nv">H</span> : P a0), P (filter H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : A,
Q b -&gt;
(Q b -&gt; P a) -&gt;
<span class="kr">exists</span> (<span class="nv">a0</span> : A) (<span class="nv">H</span> : P a0), P (filter H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk2"><span class="nb">intros</span> ?? H H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> (<span class="nv">a</span> : A) (<span class="nv">H</span> : P a), P (filter H)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk3"><span class="kp">do</span> <span class="mi">2</span> <span class="nb">eexists</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (filter <span class="nl">?H</span>)</div></blockquote></div></div></small></span></pre><p>At this point, there are two solutions that don't answer my questions:
(1) I could run (<span class="docutils literal">eauto</span>) and then do <span class="docutils literal">Grab Existential Variables</span>, but suppose that <span class="docutils literal">eauto</span> doesn't succeed until I
instantiate the unification variable; (2) I could just pass the proof
term explicitly with <span class="docutils literal">instantiate (1 := H0 H)</span> (or even
<span class="docutils literal">instantiate (1:= <span class="pre">ltac:(eauto))</span></span>), but assume that the proof of the
existential was tedious and we wished to do it interactively.</p>
<p>What else can we do? We can try to use <span class="docutils literal">cut</span> or <span class="docutils literal">assert</span>, like so:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk4"><span class="kr">match goal with</span>
  | [|- P (filter <span class="nl">?x</span>)] =&gt;
    <span class="kr">match</span> <span class="kp">type of</span> x <span class="kr">with</span>
    | <span class="nl">?T</span> =&gt; <span class="nb">assert</span> (HH : T) <span class="bp">by</span> <span class="nb">eauto</span>
    <span class="kr">end</span>
  <span class="kr">end</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br><span><var>HH</var><span class="hyp-type"><b>: </b><span>P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (filter <span class="nl">?H</span>)</div></blockquote></div></div></small></span></pre><p>But <span class="docutils literal">HH</span> is not in the context of the unification variable, so it
can't be instantiated.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input checked="checked" class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk5"><span class="kn">Fail</span> <span class="nb">instantiate</span> (<span class="mi">1</span> := HH).</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">The command has indeed failed <span class="kr">with</span> message:
<span class="kn">Instance</span> <span class="nf">is</span> <span class="nv">not</span> <span class="nv">well</span>-typed <span class="kr">in</span> the environment of <span class="nl">?H</span>.</blockquote></div></div></small><span class="alectryon-wsp">
</span></span></pre><p>As far as I can tell, the only way to solve this is to use <span class="docutils literal">Show Existentials</span>, see the type of the variable copy it by hand, roll
back the proof to before the unification was introduced and construct
the variable there. In the example it looks like this:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk6"><span class="kn">Lemma</span> <span class="nf">my_lemma</span>:
  <span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span>, Q b -&gt; (Q b -&gt; P a) -&gt;
              <span class="kr">exists</span> <span class="nv">a</span> (<span class="nv">H</span>: P a), P (filter H).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : A,
Q b -&gt;
(Q b -&gt; P a) -&gt;
<span class="kr">exists</span> (<span class="nv">a0</span> : A) (<span class="nv">H</span> : P a0), P (filter H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk7"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : A,
Q b -&gt;
(Q b -&gt; P a) -&gt;
<span class="kr">exists</span> (<span class="nv">a0</span> : A) (<span class="nv">H</span> : P a0), P (filter H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk8"><span class="nb">intros</span> ?? H H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> (<span class="nv">a</span> : A) (<span class="nv">H</span> : P a), P (filter H)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chk9"><span class="kp">do</span> <span class="mi">2</span> <span class="nb">eexists</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (filter <span class="nl">?H</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chka"><span class="kn">Show Existentials</span>.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message"><span class="kn">Existential</span> <span class="mi">1</span> =
<span class="nl">?a</span> : [a : A  b : A  H : Q b  H0 : Q b -&gt; P a |- A] (shelved)
<span class="kn">Existential</span> <span class="mi">2</span> =
<span class="nl">?H</span> : [a : A  b : A  H : Q b  H0 : Q b -&gt; P a |- P <span class="nl">?a</span>] (shelved)
<span class="kn">Existential</span> <span class="mi">3</span> =
<span class="nl">?Goal</span> : [a : A  b : A  H : Q b  H0 : Q b -&gt; P a
        |- P (filter <span class="nl">?H</span>)]</blockquote></div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (filter <span class="nl">?H</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chkb"><span class="kn">Restart</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : A,
Q b -&gt;
(Q b -&gt; P a) -&gt;
<span class="kr">exists</span> (<span class="nv">a0</span> : A) (<span class="nv">H</span> : P a0), P (filter H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* This command restores the proof editing process to the original goal. *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chkc"><span class="nb">intros</span> ?? H H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> (<span class="nv">a</span> : A) (<span class="nv">H</span> : P a), P (filter H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chkd"><span class="nb">assert</span> (HH: P a) <span class="bp">by</span> <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br><span><var>HH</var><span class="hyp-type"><b>: </b><span>P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> (<span class="nv">a</span> : A) (<span class="nv">H</span> : P a), P (filter H)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chke"><span class="nb">eexists</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br><span><var>HH</var><span class="hyp-type"><b>: </b><span>P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">H1</span> : P <span class="nl">?a</span>, P (filter H1)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-turn-an-single-unification-variable-into-a-goal-during-proof-v-chkf"><span class="kr">exists</span> <span class="nv">HH</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q b</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>Q b -&gt; P a</span></span></span><br><span><var>HH</var><span class="hyp-type"><b>: </b><span>P a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P (filter HH)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Obviously, I would like to avoid this workflow. So, anyway to turn the
existential variables into subgoals?</p>
</section>
<section id="answer">
<h2>Answer</h2>
<p>Your best bet is probably to avoid creating the existential variable
as an evar in the first place. You don't have to construct the
variable by hand to do this; if you can identify where it's created,
you can wrap the offending tactic with <span class="docutils literal">unshelve t</span>, which turns all
evars created by <span class="docutils literal">t</span> into goals. Where this might be difficult is if
the relevant tactic is deep inside some automation and difficult to
identify or change.</p>
</section>
</div>
</main>
</div></body>
</html>
