<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<title>Proof automation in Coq how to factorize a proof</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><div class="document" id="proof-automation-in-coq-how-to-factorize-a-proof">
<h1 class="title">Proof automation in Coq how to factorize a proof</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr class="link field"><th class="docinfo-name">Link:</th><td class="field-body"><a class="reference external" href="https://stackoverflow.com/q/34581945">https://stackoverflow.com/q/34581945</a></td>
</tr>
</tbody>
</table>
<input type="checkbox" class="alectryon-toggle" id="alectryon-toggle-0" /><label for="alectryon-toggle-0" class="alectryon-toggle-label">Display all goals and responses</label><div class="alectryon-container docutils container">
<div class="section" id="question">
<h1>Question</h1>
<p>I'm following the book Software Foundation and I'm on the chapter
named &quot;Imp&quot;.</p>
<p>The authors expose a small language that is the following:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">aexp</span> : <span class="kt">Type</span> :=
| ANum : nat -&gt; aexp
| APlus : aexp -&gt; aexp -&gt; aexp
| AMinus : aexp -&gt; aexp -&gt; aexp
| AMult : aexp -&gt; aexp -&gt; aexp.</span></span></pre><p>Here is the function to evaluate these expressions:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Fixpoint</span> <span class="nf">aeval</span> (<span class="nv">a</span> : aexp) : nat :=
  <span class="kr">match</span> a <span class="kr">with</span>
  | ANum n =&gt; n
  | APlus a1 a2 =&gt; aeval a1 + aeval a2
  | AMinus a1 a2 =&gt; aeval a1 - aeval a2
  | AMult a1 a2 =&gt; aeval a1 * aeval a2
  <span class="kr">end</span>.</span></span></pre><p>The exercise is to create a function that optimize the evaluation. For
example:</p>
<pre class="code coq literal-block">
<span class="n">APlus</span> <span class="n">a</span> <span class="o">(</span><span class="n">ANum</span> <span class="mi">0</span><span class="o">)</span> <span class="o">--&gt;</span> <span class="n">a</span>
</pre>
<p>Here there is my optimize function:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Fixpoint</span> <span class="nf">optimizer_a</span> (<span class="nv">a</span> : aexp) : aexp :=
  <span class="kr">match</span> a <span class="kr">with</span>
  | ANum n =&gt; ANum n
  | APlus (ANum <span class="mi">0</span>) e2 =&gt; optimizer_a e2
  | APlus e1 (ANum <span class="mi">0</span>) =&gt; optimizer_a e1
  | APlus e1 e2 =&gt; APlus (optimizer_a e1) (optimizer_a e2)
  | AMinus e1 (ANum <span class="mi">0</span>) =&gt; optimizer_a e1
  | AMinus e1 e2 =&gt; AMinus (optimizer_a e1) (optimizer_a e2)
  | AMult (ANum <span class="mi">1</span>) e2 =&gt; optimizer_a e2
  | AMult e1 (ANum <span class="mi">1</span>) =&gt; optimizer_a e1
  | AMult e1 e2 =&gt; AMult (optimizer_a e1) (optimizer_a e2)
  <span class="kr">end</span>.</span></span></pre><p>And now, I would prove that the optimization function is sound:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk0"><span class="kn">Theorem</span> <span class="nf">optimizer_a_sound</span> : <span class="kr">forall</span> <span class="nv">a</span>, aeval (optimizer_a a) = aeval a.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : aexp, aeval (optimizer_a a) = aeval a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span></pre><p>This proof is quite difficult. So I tried to decompose the proof using
some lemmas.</p>
<p>Here is one lemma:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1"><span class="kn">Lemma</span> <span class="nf">optimizer_a_plus_sound</span> : <span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span>,
    aeval (optimizer_a (APlus a b)) =
      aeval (APlus (optimizer_a a) (optimizer_a b)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : aexp,
aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span></pre><p>I have the proof, but it is boring. I do an induction on <tt class="docutils literal">a</tt> and
then, for every case, I destruct <tt class="docutils literal">b</tt> and destruct the <tt class="docutils literal">aexp</tt> to
handle the case when <tt class="docutils literal">b</tt> is <tt class="docutils literal">0</tt>.</p>
<p>I need to do that because</p>
<pre class="code literal-block">
n + 0 = n
</pre>
<p>doesn't reduce automatically, we need a theorem which is <tt class="docutils literal">plus_0_r</tt>.</p>
<p>Now, I wonder, how can I build a better proof with Coq in order to
avoid some boring repetitions during the proof.</p>
<p>Here is my proof for this lemma:</p>
<p><a class="reference external" href="http://pastebin.com/pB76JFGv">http://pastebin.com/pB76JFGv</a></p>
<p>I think I should use <tt class="docutils literal">Hint Rewrite plus_0_r</tt> but I don't know how.</p>
<p>By the way, I'm also interested to know some tips in order to show the
initial theorem (the soudness of my optimization function).</p>
</div>
<div class="section" id="answer-larsr">
<h1>Answer (larsr)</h1>
<p>When you are working with induction on data structures and need to
consider cases, here is one method I found useful to consider the
cases of a variable <tt class="docutils literal">X</tt>, get rid of the impossible cases, and solve
the trivial ones.</p>
<pre class="code coq literal-block">
<span class="nb">destruct</span> <span class="n">X</span><span class="o">;</span> <span class="kp">try</span> <span class="bp">congruence</span><span class="o">;</span> <span class="nb">auto</span><span class="o">.</span>
</pre>
<p>In your case, we can use it to prove useful rewrite lemmas about the
<tt class="docutils literal">optimization_a</tt> function.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk2"><span class="kn">Lemma</span> <span class="nf">opt1</span> : <span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span>, a = ANum <span class="mi">0</span> -&gt; optimizer_a (APlus a b) = optimizer_a b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : aexp,
a = ANum <span class="mi">0</span> -&gt; optimizer_a (APlus a b) = optimizer_a b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk3"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>a = ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">optimizer_a (APlus a b) = optimizer_a b</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> a; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>;
    <span class="nb">destruct</span> n; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk4"><span class="kn">Lemma</span> <span class="nf">opt2</span> : <span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span>, b = ANum <span class="mi">0</span> -&gt; optimizer_a (APlus a b) = optimizer_a a.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : aexp,
b = ANum <span class="mi">0</span> -&gt; optimizer_a (APlus a b) = optimizer_a a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk5"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>b = ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">optimizer_a (APlus a b) = optimizer_a a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> a; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>;
    <span class="nb">destruct</span> b; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>;
    <span class="nb">destruct</span> n; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>;
    <span class="nb">destruct</span> n0; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk6"><span class="kn">Lemma</span> <span class="nf">opt3</span> : <span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span>,
    a &lt;&gt; ANum <span class="mi">0</span> -&gt; b &lt;&gt; ANum <span class="mi">0</span> -&gt;
    optimizer_a (APlus a b) = APlus (optimizer_a a) (optimizer_a b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : aexp,
a &lt;&gt; ANum <span class="mi">0</span> -&gt;
b &lt;&gt; ANum <span class="mi">0</span> -&gt;
optimizer_a (APlus a b) =
APlus (optimizer_a a) (optimizer_a b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk7"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : aexp,
a &lt;&gt; ANum <span class="mi">0</span> -&gt;
b &lt;&gt; ANum <span class="mi">0</span> -&gt;
optimizer_a (APlus a b) =
APlus (optimizer_a a) (optimizer_a b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk8"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>a &lt;&gt; ANum <span class="mi">0</span></span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>b &lt;&gt; ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">optimizer_a (APlus a b) =
APlus (optimizer_a a) (optimizer_a b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> a; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>;
    <span class="nb">destruct</span> b; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>;
    <span class="nb">destruct</span> n; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>;
    <span class="nb">destruct</span> n0; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Actually, these proofs can also be written more compactly as
one-liners with some insight and Ltac-fu, but my point here is to show
that it can also be used almost mechanically.</p>
<p>Also note the use of semicolon instead of point to string together the
tactics so that they work on all the remaining goals after each step.</p>
<p>Anyway, now that we have these lemmas, we can consider the different
cases (Is <tt class="docutils literal">a = ANum 0</tt> or not? Is <tt class="docutils literal">b</tt>?), and just rewrite. To
consider the cases, we need one more lemma that states that <tt class="docutils literal">a</tt> is
either <tt class="docutils literal">ANum 0</tt> or it isn't.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk9"><span class="kn">Lemma</span> <span class="nf">ANum0_dec</span> : <span class="kr">forall</span> <span class="nv">a</span>, {a = ANum <span class="mi">0</span>} + {a &lt;&gt; ANum <span class="mi">0</span>}.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : aexp, {a = ANum <span class="mi">0</span>} + {a &lt;&gt; ANum <span class="mi">0</span>}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> a; <span class="kp">try</span> <span class="nb">destruct</span> n; <span class="kp">try</span> (<span class="nb">right</span>; <span class="bp">discriminate</span>); <span class="nb">left</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>We can destruct <tt class="docutils literal">ANum0_dec a</tt> and get either <tt class="docutils literal">a = ANum 0</tt> in the
context, or <tt class="docutils literal">a &lt;&gt; ANum 0</tt> in the context.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Arith. <span class="c">(* for &quot;auto with arith&quot; to handle n = n + 0 *)</span></span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chka"><span class="kn">Lemma</span> <span class="nf">optimizer_a_plus_sound</span> : <span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span>,
    aeval (optimizer_a (APlus a b)) =
      aeval (APlus (optimizer_a a) (optimizer_a b)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : aexp,
aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chkb"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : aexp,
aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chkc"><span class="nb">intros</span> a b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chkd"><span class="nb">destruct</span> (ANum0_dec a);  <span class="nb">destruct</span> (ANum0_dec b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>a = ANum <span class="mi">0</span></span></span></span><br><span><var>e0</var><span class="hyp-type"><b>: </b><span>b = ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chke" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>a = ANum <span class="mi">0</span></span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>b &lt;&gt; ANum <span class="mi">0</span></span></span></span><br></div><label class="goal-separator" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chke"><hr></label><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote><input class="alectryon-extra-goal-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chkf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>a &lt;&gt; ANum <span class="mi">0</span></span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>b = ANum <span class="mi">0</span></span></span></span><br></div><label class="goal-separator" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chkf"><hr></label><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote><input class="alectryon-extra-goal-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk10" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>a &lt;&gt; ANum <span class="mi">0</span></span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>b &lt;&gt; ANum <span class="mi">0</span></span></span></span><br></div><label class="goal-separator" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk10"><hr></label><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk11">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>a = ANum <span class="mi">0</span></span></span></span><br><span><var>e0</var><span class="hyp-type"><b>: </b><span>b = ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> opt1; <span class="nb">subst</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk12">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>a = ANum <span class="mi">0</span></span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>b &lt;&gt; ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> opt1; <span class="nb">subst</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk13">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>a &lt;&gt; ANum <span class="mi">0</span></span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>b = ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> opt2; <span class="nb">subst</span>; <span class="nb">simpl</span>; <span class="nb">auto with</span> arith.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk14">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>a &lt;&gt; ANum <span class="mi">0</span></span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>b &lt;&gt; ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> opt3; <span class="nb">subst</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre></div>
<div class="section" id="answer-larsr-1">
<h1>Answer (larsr)</h1>
<p>If you use the technique above, you can define your own tactical, so
you don't have to type as much. And since the proofs are very short,
you could do without the lemmas. (I called the tactical <tt class="docutils literal">dca</tt> for
<tt class="docutils literal">destruct</tt>-<tt class="docutils literal">congruence</tt>-<tt class="docutils literal">auto</tt>.)</p>
<p>The shorter proof is not that readable, but it is essentially:
consider the cases of the variables.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk15"><span class="kn">Lemma</span> <span class="nf">ANum0_dec</span> : <span class="kr">forall</span> <span class="nv">a</span>, {a = ANum <span class="mi">0</span>} + {a &lt;&gt; ANum <span class="mi">0</span>}.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : aexp, {a = ANum <span class="mi">0</span>} + {a &lt;&gt; ANum <span class="mi">0</span>}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> a; <span class="kp">try</span> <span class="nb">destruct</span> n; <span class="kp">try</span> (<span class="nb">right</span>; <span class="bp">discriminate</span>); <span class="nb">left</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Arith.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">dca</span> v := <span class="nb">destruct</span> v; <span class="kp">try</span> <span class="bp">congruence</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk16"><span class="kn">Lemma</span> <span class="nf">optimizer_a_plus_sound</span> : <span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span>,
    aeval (optimizer_a (APlus a b)) =
      aeval (APlus (optimizer_a a) (optimizer_a b)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : aexp,
aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk17"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> <span class="nv">b</span> : aexp,
aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk18"><span class="nb">intros</span> a b.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk19"><span class="nb">destruct</span> (ANum0_dec a), (ANum0_dec b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>a = ANum <span class="mi">0</span></span></span></span><br><span><var>e0</var><span class="hyp-type"><b>: </b><span>b = ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>a = ANum <span class="mi">0</span></span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>b &lt;&gt; ANum <span class="mi">0</span></span></span></span><br></div><label class="goal-separator" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1a"><hr></label><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote><input class="alectryon-extra-goal-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>a &lt;&gt; ANum <span class="mi">0</span></span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>b = ANum <span class="mi">0</span></span></span></span><br></div><label class="goal-separator" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1b"><hr></label><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote><input class="alectryon-extra-goal-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>a &lt;&gt; ANum <span class="mi">0</span></span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>b &lt;&gt; ANum <span class="mi">0</span></span></span></span><br></div><label class="goal-separator" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1c"><hr></label><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1d" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>a = ANum <span class="mi">0</span></span></span></span><br><span><var>e0</var><span class="hyp-type"><b>: </b><span>b = ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">dca a; dca n.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>a = ANum <span class="mi">0</span></span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>b &lt;&gt; ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">dca a; dca n0.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1f" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk1f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>a &lt;&gt; ANum <span class="mi">0</span></span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>b = ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">dca b; dca n0; dca a; <span class="nb">simpl</span>; <span class="nb">auto with</span> arith; dca n0.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk20">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a, b</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>a &lt;&gt; ANum <span class="mi">0</span></span></span></span><br><span><var>n0</var><span class="hyp-type"><b>: </b><span>b &lt;&gt; ANum <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a b)) =
aeval (APlus (optimizer_a a) (optimizer_a b))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">dca a; dca b; dca n1; dca n2.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Then use it</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk21"><span class="kn">Theorem</span> <span class="nf">optimizer_a_sound</span> : <span class="kr">forall</span> <span class="nv">a</span>, aeval (optimizer_a a) = aeval a.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">a</span> : aexp, aeval (optimizer_a a) = aeval a</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk22"><span class="nb">induction</span> a.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (ANum n)) = aeval (ANum n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk23" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a1, a2</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>IHa1</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a1) = aeval a1</span></span></span><br><span><var>IHa2</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a2) = aeval a2</span></span></span><br></div><label class="goal-separator" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk23"><hr></label><div class="goal-conclusion">aeval (optimizer_a (APlus a1 a2)) =
aeval (APlus a1 a2)</div></blockquote><input class="alectryon-extra-goal-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk24" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a1, a2</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>IHa1</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a1) = aeval a1</span></span></span><br><span><var>IHa2</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a2) = aeval a2</span></span></span><br></div><label class="goal-separator" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk24"><hr></label><div class="goal-conclusion">aeval (optimizer_a (AMinus a1 a2)) =
aeval (AMinus a1 a2)</div></blockquote><input class="alectryon-extra-goal-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk25" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a1, a2</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>IHa1</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a1) = aeval a1</span></span></span><br><span><var>IHa2</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a2) = aeval a2</span></span></span><br></div><label class="goal-separator" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk25"><hr></label><div class="goal-conclusion">aeval (optimizer_a (AMult a1 a2)) =
aeval (AMult a1 a2)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk26">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (ANum n)) = aeval (ANum n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk27">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a1, a2</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>IHa1</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a1) = aeval a1</span></span></span><br><span><var>IHa2</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a2) = aeval a2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (APlus a1 a2)) =
aeval (APlus a1 a2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> optimizer_a_plus_sound; <span class="nb">simpl</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="proof-automation-in-coq-how-to-factorize-a-proof-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="proof-automation-in-coq-how-to-factorize-a-proof-v-chk28">- <span class="c">(* ... and so on for Minus and Mult *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>a1, a2</var><span class="hyp-type"><b>: </b><span>aexp</span></span></span><br><span><var>IHa1</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a1) = aeval a1</span></span></span><br><span><var>IHa2</var><span class="hyp-type"><b>: </b><span>aeval (optimizer_a a2) = aeval a2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aeval (optimizer_a (AMinus a1 a2)) =
aeval (AMinus a1 a2)</div></blockquote></div></div></small></span></pre><p>You could probably also do the full proof in this compact form.</p>
</div>
</div>
</div>
</div></body>
</html>
