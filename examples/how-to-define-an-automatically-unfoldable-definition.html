<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta charset="utf-8" />
<meta name="generator" content="Docutils 0.21.2: https://docutils.sourceforge.io/" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>How to define an automatically unfoldable definition</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-centered"><main id="how-to-define-an-automatically-unfoldable-definition">
<h1 class="title">How to define an automatically unfoldable definition</h1>
<dl class="docinfo simple">
<dt class="link">Link<span class="colon">:</span></dt>
<dd class="link"><p><a class="reference external" href="https://stackoverflow.com/q/47594706">https://stackoverflow.com/q/47594706</a></p>
</dd>
</dl>
<input type="checkbox" class="alectryon-toggle" id="alectryon-toggle-0" /><label for="alectryon-toggle-0" class="alectryon-toggle-label">Display all goals and responses</label><div class="alectryon-container docutils container">
<section id="question">
<h2>Question</h2>
<p>I sometimes want to define some shortcut for existing functions like
in the following example:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Parameter</span> <span class="nv">T</span> : <span class="kt">Set</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Parameter</span> <span class="nv">zero</span> <span class="nv">one</span> : T.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Parameter</span> <span class="nv">f</span> : T -&gt; T -&gt; option T.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk0"><span class="kn">Hypothesis</span> <span class="nv">f_unit</span> : <span class="kr">forall</span> <span class="nv">t</span>, f zero t = None.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Interpreting this declaration <span class="kr">as</span> <span class="kr">if</span> a <span class="kn">global</span>
declaration prefixed <span class="bp">by</span> <span class="s2">&quot;Local&quot;</span>, i.e. <span class="kr">as</span> a <span class="kn">global</span>
declaration which shall not be available without
qualification when imported. [local-declaration,scope]</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">g</span> (<span class="nv">t</span> : T) := f t one.</span></span></pre><p>However, this definition seems to be abstract since I cannot use
theorems about <span class="docutils literal">f</span> on instances of <span class="docutils literal">g</span> without first unfolding:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk1"><span class="kn">Goal</span> g zero = None.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">g zero = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk2"><span class="nb">unfold</span> g.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">f zero one = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk3"><span class="nb">rewrite</span> f_unit.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">None = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Is there a way to mark definitions as automatically unfoldable?</p>
<hr class="docutils" />
<p><strong>A:</strong> Yes, I would like not to have to manually <span class="docutils literal">unfold</span>.</p>
<p><strong>A:</strong> You could allow <span class="docutils literal">simpl</span> to expand the definition of <span class="docutils literal">g</span> by
declaring <span class="docutils literal">Arguments g t /.</span></p>
<p><strong>A:</strong> Or define <span class="docutils literal">g</span> as a &quot;parsing-only&quot; shorthand notation instead
of a function. Something like: <span class="docutils literal">Notation &quot;'g' t&quot; := (f t one) (at level 0, parsing only).</span></p>
<p><strong>A:</strong> Or <span class="docutils literal">Hint Unfold g.</span> and then use <span class="docutils literal">autounfold</span> tactic in the
proof.</p>
<p><strong>A:</strong> Also, ssreflect can do it with with context patterns: <span class="docutils literal">Require Import ssreflect.</span> then your goal can be proved by <span class="docutils literal">by rewrite [g _]f_unit.</span>. This <span class="docutils literal">[g _]</span> pattern makes <span class="docutils literal">rewrite</span> to unfold the
definition of <span class="docutils literal">g</span>.</p>
</section>
<section id="answer">
<h2>Answer</h2>
<p>There are a couple of ways to accomplish what you ask, and here is an
explanation of the ones I know:</p>
<hr class="docutils" />
<ol class="arabic">
<li><p>Use an abbreviation. To quote <a class="reference external" href="https://coq.inria.fr/refman/syntax-extensions.html#Abbreviations">the reference manual</a>:</p>
<blockquote>
<p>An <em>abbreviation</em> is a name, possibly applied to arguments,
that denotes a (presumably) more complex expression.</p>
<p>[...]</p>
<p>Abbreviations are bound to an absolute name as an ordinary
definition is, and they can be referred by qualified names too.</p>
<p>Abbreviations are syntactic in the sense that they are bound to
expressions which are not typed at the time of the definition
of the abbreviation but at the time it is used.</p>
</blockquote>
<p>In your case, this would be</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="nf">g</span> t := (f t one).</span></span></pre><p>This is much like Daniel Schepler's suggestion of a <span class="docutils literal">Notation</span>,
except that it does not reserve <span class="docutils literal">g</span> as a global keyword.</p>
</li>
</ol>
<hr class="docutils" />
<ol class="arabic" start="2">
<li><p>Use <span class="docutils literal">setoid_rewrite</span>. Coq's <span class="docutils literal">setoid_rewrite</span> tactic is similar
to <span class="docutils literal">rewrite</span>, except that it looks for occurrences modulo Î´
(unfolding), can rewrite under binders, and a few other minor
things.</p>
<p>For your example, this is:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Require Import</span> Coq.Setoids.Setoid.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk4"><span class="kn">Goal</span> g zero = None.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">g zero = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk5"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">g zero = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk6"><span class="nb">setoid_rewrite</span> f_unit.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">None = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre></li>
</ol>
<hr class="docutils" />
<ol class="arabic" start="3">
<li><p>In some cases, you can use <span class="docutils literal">Set Keyed Unification</span> and <span class="docutils literal">Declare Equivalent Keys</span>, though this does not work in your case (I've
opened an issue <a class="reference external" href="https://github.com/coq/coq/issues/6317">on GitHub here</a>. This tells <span class="docutils literal">rewrite</span>
to &quot;unfold&quot; one head constant to another, though it apparently
isn't quite good enough to handle your case. There's a bit of
documentation <a class="reference external" href="https://github.com/coq/coq/commit/3fe4912b568916676644baeb982a3e10c592d887">on the relevant commit message</a>,
and an <a class="reference external" href="https://github.com/coq/coq/issues/4551">open issue to add proper documentation</a>.</p>
<p>Here is an example this is useful:</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Parameter</span> <span class="nv">T</span> : <span class="kt">Set</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Parameter</span> <span class="nv">zero</span> <span class="nv">one</span>: T.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Parameter</span> <span class="nv">f</span> : T -&gt; T -&gt; option T.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk7"><span class="kn">Hypothesis</span> <span class="nv">f_unit</span> : <span class="kr">forall</span> <span class="nv">t</span>, f zero t = None.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Interpreting this declaration <span class="kr">as</span> <span class="kr">if</span> a <span class="kn">global</span>
declaration prefixed <span class="bp">by</span> <span class="s2">&quot;Local&quot;</span>, i.e. <span class="kr">as</span> a <span class="kn">global</span>
declaration which shall not be available without
qualification when imported. [local-declaration,scope]</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">g</span> := f zero zero.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Set Keyed Unification</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk8"><span class="kn">Goal</span> g = None.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">g = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chk9"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">g = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chka" style="display: none" type="checkbox"><label class="alectryon-input alectryon-failed" for="how-to-define-an-automatically-unfoldable-definition-v-chka"><span class="nb">rewrite</span> f_unit.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">Found no subterm matching <span class="s2">&quot;f zero ?M160&quot;</span> <span class="kr">in</span> the current goal.</blockquote></div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">g = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chkb">Declare Equivalent Keys g f.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">g = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="how-to-define-an-automatically-unfoldable-definition-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="how-to-define-an-automatically-unfoldable-definition-v-chkc"><span class="nb">rewrite</span> f_unit.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">None = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre></li>
</ol>
</section>
</div>
</main>
</div></body>
</html>
